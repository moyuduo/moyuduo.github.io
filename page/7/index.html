<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.107.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Moyuduo's Blog</title><meta name=keywords content="Blog,Portfolio,PaperMod"><meta name=description content="Moyuduo's Blog description"><meta name=author content="Me"><link rel=canonical href=https://moyuduo.github.io/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><link rel=icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://moyuduo.github.io/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Moyuduo's Blog"><meta property="og:description" content="Moyuduo's Blog description"><meta property="og:type" content="website"><meta property="og:url" content="https://moyuduo.github.io/"><meta property="og:image" content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="Moyuduo's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Moyuduo's Blog"><meta name=twitter:description content="Moyuduo's Blog description"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Moyuduo's Blog","url":"https://moyuduo.github.io/","description":"Moyuduo\u0026#39;s Blog description","thumbnailUrl":"https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E","sameAs":["https://twitter.com/","https://stackoverflow.com","https://github.com/"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://moyuduo.github.io/ accesskey=h title="Moyuduo's Blog (Alt + H)"><img src=https://moyuduo.github.io/apple-touch-icon.png alt aria-label=logo height=35>Moyuduo's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://moyuduo.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://moyuduo.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2>kustomize</h2></header><div class=entry-content><p>是什么 kustomize 使用 k8s 原生概念帮助创建并复用资源配置(YAML)，允许用户以一个应用描述文件 （YAML 文件）为基础（Base YAML），然后通过 Overlay 的方式生成最终部署应用所需的描述文件。
可以把kustomize理解为轻量级的helm。
解决什么问题 一般应用都会存在多套部署环境：开发环境、测试环境、生产环境，多套环境意味着存在多套 K8S 应用资源 YAML。而这么多套 YAML 之间只存在微小配置差异，比如镜像版本不同、Label 不同等，而这些不同环境下的YAML 经常会因为人为疏忽导致配置错误。再者，多套环境的 YAML 维护通常是通过把一个环境下的 YAML 拷贝出来然后对差异的地方进行修改。
概念 kustomization：指的是 kustomization.yaml 文件，或者指的是包含kustomization.yaml 文件的目录以及它里面引用的所有相关文件路径 base：base 指的是一个 kustomization , 任何的 kustomization 包括 overlay，都可以作为另一个 kustomization 的 base (简单理解为基础目录)。base中描述了共享的内容，如资源和常见的资源配置。base 是需要通过 overlay 修订的基础配置 overlay：overlay 是一个 kustomization, 它修改(并因此依赖于)另外一个 kustomization variant：variant 是在集群中将 overlay 应用于 base 的结果。例如开发和生产环境都修改了一些共同 base以创建不同的 variant。这些 variant 使用相同的总体资源，并与简单的方式变化，例如 deployment的副本数、ConfigMap使用的数据源等。简而言之，variant 是含有同一组 base 的不同 resource：resource 是描述 k8s API 对象的 YAML 或 JSON文件的相对路径。即是指向一个声明了 kubernetes API 对象的 YAML 文件 patch：修改文件的一般说明。文件路径，指向一个声明了 kubernetes API patch 的 YAML 文件 安装 go get github....</p></div><footer class=entry-footer><span title='2022-11-27 16:16:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1135 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to kustomize" href=https://moyuduo.github.io/posts/kustomize/></a></article><article class=post-entry><header class=entry-header><h2>LinkedHashMap源码分析</h2></header><div class=entry-content><p>LinkedHashMap源码分析 为什么要有LinkedHashMap？ 在分析HashMap的时候提到了HashMap是无序的，即添加节点的顺序和遍历的顺序不一致 @Test public void test1() { HashMap&lt;String,String> hashMap=new HashMap&lt;String, String>(); hashMap.put("tom", "american"); hashMap.put("jack", "chainese"); hashMap.put("mary", "japanese"); Set&lt;Entry&lt;String, String>> entrySet = hashMap.entrySet(); Iterator&lt;Entry&lt;String, String>> iterator = entrySet.iterator(); while(iterator.hasNext()) { Entry&lt;String, String> entry = iterator.next(); String key = entry.getKey(); String value = entry.getValue(); System.out.println(key+":"+value); } } 输出： tom:american mary:japanese jack:chainese LinkedHashMap保证节点的顺序，这也是LinkedHashMap和HashMap的主要区别 @Test public void test2() { LinkedHashMap&lt;String,String> linkedHashMap=new LinkedHashMap(); linkedHashMap.put("tom", "american"); linkedHashMap.put("jack", "chainese"); linkedHashMap.put("mary", "japanese"); Set&lt;Entry&lt;String, String>> entrySet = linkedHashMap.entrySet(); Iterator&lt;Entry&lt;String, String>> iterator = entrySet....</p></div><footer class=entry-footer><span title='2022-11-27 16:16:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;923 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to LinkedHashMap源码分析" href=https://moyuduo.github.io/posts/linkedhashmap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/></a></article><article class=post-entry><header class=entry-header><h2>linux vxlan和tun网络</h2></header><div class=entry-content><p>linux vxlan和tun网络 vlan和tun都属于overlay网络，即建立在一个屋里网络(Underlay网络)之上的虚拟网络，Underlay网络是真正存在的实体，承载Overlay网络的通信。如两个设备通过udp/tcp进行通信这就是Underlay网络。但是在udp/tcp之上承载的应用层数据中如果包含了IP协议的数据，那么这就是Overlay三层网络，如果应用层数据包含了数据链路层的数据，那么这就是Overlay二层网络。
linux tun:在四层网络之上构建三层网络。
overlay网络通信协议位于Ip层及以上。
overlay网络不支持arp协议。(arp协议位于数据链路层)
linux vxlan:在四层网络之上构建二层网络。
overlay网络通信协议位于Ip层及以上。
overlay网络支持arp协议。
vxlan实验 在host1上配置:
ip link add name vxlan100 type vxlan id 100 dstport 4789 local 192.168.37.131 remote 192.168.37.134 ip link set vxlan100 up ip addr add 172.17.0.4/32 dev vxlan100 ip route add 172.17.0.0/24 dev vxlan100 在host2上配置:
ip link add name vxlan100 type vxlan id 100 dstport 4789 local 192.168.37.134 remote 192.168.37.131 ip link set vxlan100 up ip addr add 172.17.0.3/32 dev vxlan100 ip route add 172....</p></div><footer class=entry-footer><span title='2022-11-27 16:16:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;81 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to linux vxlan和tun网络" href=https://moyuduo.github.io/posts/linux-vxlan%E5%92%8Ctun%E7%BD%91%E7%BB%9C/></a></article><article class=post-entry><header class=entry-header><h2>linux命令自查</h2></header><div class=entry-content><p>linux命令自查 查看cpu和内存 cpu个数 cat /proc/cpuinfo | grep "physical id" | uniq | wc -l cpu核数 cat /proc/cpuinfo | grep "cpu cores" | uniq cpu型号 cat /proc/cpuinfo | grep 'model name' |uniq 内存大小 cat /proc/meminfo | grep MemTotal 设置linux开机自启动 linux文件/etc/rc.local文件中的内容会linux启动完成后执行，所以可以用来做开机自启动，/etc/rc.local默认是lrwxrwxrwx权限，但是由于它是/etc/rc.d/rc.local的一个软连接，所以/etc/rc.d/rc.local这个文件必须要有执行权限才能开机自启动，而这个人间默认是-rw-rw-rw-权限，所以必须要修改添加执行权限,注意在这个文件中添加开机执行死循环脚本时必须使用&后台执行。
秒级检测脚本 #!/bin/bash while true do count=`ps -ef|grep etcd|grep -v grep|wc -l` if [ $count -eq 0 ]; then cd /opt/etcd-v3.5.0-linux-amd64 ./etcd -listen-client-urls="http://0.0.0.0:2379" --advertise-client-urls="http://0.0.0.0:2379" echo "restart etcd at $(date)" >> /opt/etcd-v3.5.0-linux-amd64/record fi sleep 1 done 原理是通过ps -ef|grep按照条件过滤执行的进程，再通过wc -l转换为进程个数，最后通过shell进行判断。...</p></div><footer class=entry-footer><span title='2022-11-27 16:16:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;15 min&nbsp;·&nbsp;3073 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to linux命令自查" href=https://moyuduo.github.io/posts/linux%E5%91%BD%E4%BB%A4%E8%87%AA%E6%9F%A5/></a></article><article class=post-entry><header class=entry-header><h2>makefile</h2></header><div class=entry-content><p>makefile 核心 makefile的主要有三个核心：目标、依赖、命令
目标：一般指要编译的文件对象
依赖：一般指要生成的可执行文件
命令：指生成目标要执行的命令
规则 所有命令都必须用tab缩进，不能使用空格也不行 如果有多个依赖可以用tab、空格分隔，如果一个目标有多个依赖，那么会依次执行依赖的命令，最后执行该目标本身的命令 $^代表所有依赖 $&lt;代表第一个依赖 $@代表目标 使用echo xxx命令会把该命令输出再输出xxx,可以使用@echo xxx来只输出xxx 如果使用空格缩进，那么会报错Makefile:2: *** missing separator. Stop. 一条makefile规则的依赖可以是该makefile中其他规则的目标，那么再执行该规则时，会去执行依赖的规则 使用make命令生成目标时会检测依赖和目标的时间戳，如果目标已经存在且目标的时间戳大于所有依赖，那么意味着依赖并没有改动，那么无需重新生成目标，会提示make: clean’ is up to date.` 如果一条makefile规则没有依赖且该目标文件存在，那么始终不会执行该规则的命令，而有些时候我会想执行一些清除操作，如rm如果这条规则的目标叫clean，如果恰巧该文件夹下有一个文件叫clean，那么就不能执行清除，此时可以使用.PHONY:clean标记clean目标不需要检查目标文件是否存在，目标文件的时间戳是否大于所有依赖 变量 ###自定义变量
makefile中可以将经常使用的命令、依赖定义成变量
makefile中变量区分大小写
makefile中对变量的引用使用$(xxx)
makefile中对变量的定义形式为A=xxx等号两边可以有空格，不需要加引号，因为makefile中变量中油字符串类型
系统变量 CC：编译器名字，默认CC等于gcc CC = arm-linux-gcc
RM：删除文件，相当于rm -f
可以使用$(ENV_NAME)来获取系统定义好的环境变量，如：$(GOPATH) $(JAVA_HOME)
自动化变量 $^代表所有依赖文件
$&lt;代表第一个依赖文件
$@代表目标文件
伪命令 如果一条makefile规则没有依赖且该目标文件存在，那么始终不会执行该规则的命令，而有些时候我会想执行一些清除操作，如rm如果这条规则的目标叫clean，如果恰巧该文件夹下有一个文件叫clean，那么就不能执行清除，此时可以使用.PHONY:clean标记clean目标不需要检查目标文件是否存在，目标文件的时间戳是否大于所有依赖
实践 GO= CGO_ENABLED=0 GO111MODULE=on go GOCGO = CGO_ENABLED=1 GO111MODULE=on go #在申明变量时，如果要执行shell中的命令获取值需要使用$(shell xxx)，这是因为如果只使用$(xxx)的话回去取xxx变量的值，而xxx变量不存在，所以要在定义变量时使用shell命令必须使用shell关键字 GP = $(shell go env GOPATH) VERSION = v2.0.0 #commit id GIT_COMMIT=$(shell git rev-parse HEAD) #branch name GIT_BRANCH=$(shell git name-rev --name-only HEAD) #构建时间 BUILD_DATE=$(shell date '+%Y-%m-%d-%H:%M:%S') #使用go build的-ldflags 参数可以在编译的时候对变量进行赋值，常用在编译时添加版本、架构、编译日期等信息 #使用-X参数进行替换，makef为项目名称，为go mod init makef, version是该项目下的一个包， Version为包中的一个变量 LDFLAGS = -ldflags "-X makef/version....</p></div><footer class=entry-footer><span title='2022-11-27 16:16:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;167 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to makefile" href=https://moyuduo.github.io/posts/makefile/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://moyuduo.github.io/page/6/>«&nbsp;Prev&nbsp;</a>
<a class=next href=https://moyuduo.github.io/page/8/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2022 <a href=https://moyuduo.github.io/>Moyuduo's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>