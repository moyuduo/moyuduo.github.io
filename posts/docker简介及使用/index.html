<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker简介及使用 | Moyuduo's Blog</title><meta name=keywords content><meta name=description content="Docker相关 为什么要使用Docker？ 想想在分布式项目中，Nginx后会有很多的服务器提供服务，并且当一些特殊的情况下我们需要对服务器进行扩容，假如我们要新增100台服务器，我们需要一个一个服务器都去装tomcat吗？每台都去进行相关配置吗？再想想我们学习开源项目，很多情况下都需要安装Mysql、Redis、MongoDB、Tomcat等，这时候一个一个去装，一个个去配置是不是很麻烦，Docker就为我们提供了一个简洁的方式完成这些工作。
简介 Docker是一个开源的应用容器引擎；是一个轻量级容器技术；
Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；
运行中的这个镜像称为容器，容器启动是非常快速的。
核心概念 docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；
docker客户端(Client)：连接docker主机进行操作；
docker仓库(Registry)：用来保存各种打包好的软件镜像；
docker镜像(Images)：软件打包好的镜像；放在docker仓库中；
docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；
安装Docker 1）可以使用VmWare或VirtualBox
2）安装好centos，内核版本必须是3.1以上，可以使用uname -r查看
3）配置好网络，保证能连上外网
4）使用yum命令安装docker
yum install docker yum list installed|grep docker #卸载原有的docker yum remove -y docker-ce docker-ce-cli docker-ce-rootless-extras docker-scan-plugin containerd.io #删除镜像、容器、配置文件等内容 rm -rf /var/lib/docker #查询docker可按照版本 yum list docker-ce --showduplicates | sort -r # !!!亲测centos7.2下安装这个版本不会有问题 yum install -y docker-ce-17.06.2.ce-1.el7.centos 20.10.7-3 yum install -y docker-ce-20.10.7-3.el7.x86_64 containerd.io systemctl start docker docker run hello-world 5)安装的过程中会提示是否继续？[y/N]：y	输入y即可	最后出现完毕!即完成
启动Docker #启动docker [root@localhost yum."><meta name=author content="Me"><link rel=canonical href=https://moyuduo.github.io/posts/docker%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BD%BF%E7%94%A8/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Docker简介及使用"><meta property="og:description" content="Docker相关 为什么要使用Docker？ 想想在分布式项目中，Nginx后会有很多的服务器提供服务，并且当一些特殊的情况下我们需要对服务器进行扩容，假如我们要新增100台服务器，我们需要一个一个服务器都去装tomcat吗？每台都去进行相关配置吗？再想想我们学习开源项目，很多情况下都需要安装Mysql、Redis、MongoDB、Tomcat等，这时候一个一个去装，一个个去配置是不是很麻烦，Docker就为我们提供了一个简洁的方式完成这些工作。
简介 Docker是一个开源的应用容器引擎；是一个轻量级容器技术；
Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；
运行中的这个镜像称为容器，容器启动是非常快速的。
核心概念 docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；
docker客户端(Client)：连接docker主机进行操作；
docker仓库(Registry)：用来保存各种打包好的软件镜像；
docker镜像(Images)：软件打包好的镜像；放在docker仓库中；
docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；
安装Docker 1）可以使用VmWare或VirtualBox
2）安装好centos，内核版本必须是3.1以上，可以使用uname -r查看
3）配置好网络，保证能连上外网
4）使用yum命令安装docker
yum install docker yum list installed|grep docker #卸载原有的docker yum remove -y docker-ce docker-ce-cli docker-ce-rootless-extras docker-scan-plugin containerd.io #删除镜像、容器、配置文件等内容 rm -rf /var/lib/docker #查询docker可按照版本 yum list docker-ce --showduplicates | sort -r # !!!亲测centos7.2下安装这个版本不会有问题 yum install -y docker-ce-17.06.2.ce-1.el7.centos 20.10.7-3 yum install -y docker-ce-20.10.7-3.el7.x86_64 containerd.io systemctl start docker docker run hello-world 5)安装的过程中会提示是否继续？[y/N]：y	输入y即可	最后出现完毕!即完成
启动Docker #启动docker [root@localhost yum."><meta property="og:type" content="article"><meta property="og:url" content="https://moyuduo.github.io/posts/docker%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BD%BF%E7%94%A8/"><meta property="og:image" content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-27T16:14:14+08:00"><meta property="article:modified_time" content="2022-11-27T16:14:14+08:00"><meta property="og:site_name" content="Moyuduo's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker简介及使用"><meta name=twitter:description content="Docker相关 为什么要使用Docker？ 想想在分布式项目中，Nginx后会有很多的服务器提供服务，并且当一些特殊的情况下我们需要对服务器进行扩容，假如我们要新增100台服务器，我们需要一个一个服务器都去装tomcat吗？每台都去进行相关配置吗？再想想我们学习开源项目，很多情况下都需要安装Mysql、Redis、MongoDB、Tomcat等，这时候一个一个去装，一个个去配置是不是很麻烦，Docker就为我们提供了一个简洁的方式完成这些工作。
简介 Docker是一个开源的应用容器引擎；是一个轻量级容器技术；
Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；
运行中的这个镜像称为容器，容器启动是非常快速的。
核心概念 docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；
docker客户端(Client)：连接docker主机进行操作；
docker仓库(Registry)：用来保存各种打包好的软件镜像；
docker镜像(Images)：软件打包好的镜像；放在docker仓库中；
docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；
安装Docker 1）可以使用VmWare或VirtualBox
2）安装好centos，内核版本必须是3.1以上，可以使用uname -r查看
3）配置好网络，保证能连上外网
4）使用yum命令安装docker
yum install docker yum list installed|grep docker #卸载原有的docker yum remove -y docker-ce docker-ce-cli docker-ce-rootless-extras docker-scan-plugin containerd.io #删除镜像、容器、配置文件等内容 rm -rf /var/lib/docker #查询docker可按照版本 yum list docker-ce --showduplicates | sort -r # !!!亲测centos7.2下安装这个版本不会有问题 yum install -y docker-ce-17.06.2.ce-1.el7.centos 20.10.7-3 yum install -y docker-ce-20.10.7-3.el7.x86_64 containerd.io systemctl start docker docker run hello-world 5)安装的过程中会提示是否继续？[y/N]：y	输入y即可	最后出现完毕!即完成
启动Docker #启动docker [root@localhost yum."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://moyuduo.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Docker简介及使用","item":"https://moyuduo.github.io/posts/docker%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BD%BF%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker简介及使用","name":"Docker简介及使用","description":"Docker相关 为什么要使用Docker？ 想想在分布式项目中，Nginx后会有很多的服务器提供服务，并且当一些特殊的情况下我们需要对服务器进行扩容，假如我们要新增100台服务器，我们需要一个一个服务器都去装tomcat吗？每台都去进行相关配置吗？再想想我们学习开源项目，很多情况下都需要安装Mysql、Redis、MongoDB、Tomcat等，这时候一个一个去装，一个个去配置是不是很麻烦，Docker就为我们提供了一个简洁的方式完成这些工作。\n简介 Docker是一个开源的应用容器引擎；是一个轻量级容器技术；\nDocker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；\n运行中的这个镜像称为容器，容器启动是非常快速的。\n核心概念 docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；\ndocker客户端(Client)：连接docker主机进行操作；\ndocker仓库(Registry)：用来保存各种打包好的软件镜像；\ndocker镜像(Images)：软件打包好的镜像；放在docker仓库中；\ndocker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；\n安装Docker 1）可以使用VmWare或VirtualBox\n2）安装好centos，内核版本必须是3.1以上，可以使用uname -r查看\n3）配置好网络，保证能连上外网\n4）使用yum命令安装docker\nyum install docker yum list installed|grep docker #卸载原有的docker yum remove -y docker-ce docker-ce-cli docker-ce-rootless-extras docker-scan-plugin containerd.io #删除镜像、容器、配置文件等内容 rm -rf /var/lib/docker #查询docker可按照版本 yum list docker-ce --showduplicates | sort -r # !!!亲测centos7.2下安装这个版本不会有问题 yum install -y docker-ce-17.06.2.ce-1.el7.centos 20.10.7-3 yum install -y docker-ce-20.10.7-3.el7.x86_64 containerd.io systemctl start docker docker run hello-world 5)安装的过程中会提示是否继续？[y/N]：y\t输入y即可\t最后出现完毕!即完成\n启动Docker #启动docker [root@localhost yum.","keywords":[],"articleBody":"Docker相关 为什么要使用Docker？ 想想在分布式项目中，Nginx后会有很多的服务器提供服务，并且当一些特殊的情况下我们需要对服务器进行扩容，假如我们要新增100台服务器，我们需要一个一个服务器都去装tomcat吗？每台都去进行相关配置吗？再想想我们学习开源项目，很多情况下都需要安装Mysql、Redis、MongoDB、Tomcat等，这时候一个一个去装，一个个去配置是不是很麻烦，Docker就为我们提供了一个简洁的方式完成这些工作。\n简介 Docker是一个开源的应用容器引擎；是一个轻量级容器技术；\nDocker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；\n运行中的这个镜像称为容器，容器启动是非常快速的。\n核心概念 docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；\ndocker客户端(Client)：连接docker主机进行操作；\ndocker仓库(Registry)：用来保存各种打包好的软件镜像；\ndocker镜像(Images)：软件打包好的镜像；放在docker仓库中；\ndocker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；\n安装Docker 1）可以使用VmWare或VirtualBox\n2）安装好centos，内核版本必须是3.1以上，可以使用uname -r查看\n3）配置好网络，保证能连上外网\n4）使用yum命令安装docker\nyum install docker yum list installed|grep docker #卸载原有的docker yum remove -y docker-ce docker-ce-cli docker-ce-rootless-extras docker-scan-plugin containerd.io #删除镜像、容器、配置文件等内容 rm -rf /var/lib/docker #查询docker可按照版本 yum list docker-ce --showduplicates | sort -r # !!!亲测centos7.2下安装这个版本不会有问题 yum install -y docker-ce-17.06.2.ce-1.el7.centos 20.10.7-3 yum install -y docker-ce-20.10.7-3.el7.x86_64 containerd.io systemctl start docker docker run hello-world 5)安装的过程中会提示是否继续？[y/N]：y\t输入y即可\t最后出现完毕!即完成\n启动Docker #启动docker [root@localhost yum.repos.d]# systemctl start docker #查看docker版本 [root@localhost yum.repos.d]# docker -v Docker version 1.13.1, build cccb291/1.13.1 #设置docker开机自启动 [root@localhost yum.repos.d]# systemctl enable docker Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service. #停止docker [root@localhost yum.repos.d]# systemctl stop docker Docker常用命令 参考docs.docker.com\nDocker镜像命令 #镜像搜索命令 [root@localhost /]# docker search mysql INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/mysql MySQL is a widely used, open-source relati... 9286 [OK] docker.io docker.io/mariadb MariaDB is a community-developed fork of M... 3315 [OK] docker.io docker.io/mysql/mysql-server Optimized MySQL Server Docker images. Crea... 682 [OK] docker.io docker.io/centos/mysql-57-centos7 MySQL 5.7 SQL database server 71 docker.io docker.io/mysql/mysql-cluster Experimental MySQL Cluster Docker images. ... 66 docker.io docker.io/centurylink/mysql Image containing mysql. Optimized to be li... 61 [OK] docker.io docker.io/deitch/mysql-backup REPLACED! Please use http://hub.docker.com... 41 [OK] docker.io docker.io/bitnami/mysql Bitnami MySQL Docker Image 36 [OK] #在搜索容器时可以加上--no-trunc --automated\t--limit --filter或-f -s 参数\t--no-trunc是值显示完整的镜像描述\t--automated是搜索自动构建的项目 -s 10 表示搜索出的项目star大于等于10 #--no-trunc [root@localhost ~]# docker search mysql --no-trunc INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/mysql MySQL is a widely used, open-source relational database management system (RDBMS). 9289 [OK] docker.io docker.io/mariadb MariaDB is a community-developed fork of MySQL intended to remain free under the GNU GPL. 3316 [OK] #--automated [root@localhost ~]# docker search mysql --automated Flag --automated has been deprecated, use --filter=automated=true instead INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/mysql/mysql-server Optimized MySQL Server Docker images. Crea... 683 [OK] docker.io docker.io/centurylink/mysql Image containing mysql. Optimized to be li... 61 [OK] #limit限制搜索出的结果条数 [root@localhost ~]# docker search --limit 3 mysql INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/mysql MySQL is a widely used, open-source relati... 9289 [OK] docker.io docker.io/mysql/mysql-server Optimized MySQL Server Docker images. Crea... 683 [OK] docker.io docker.io/circleci/mysql MySQL is a widely used, open-source relati... 19 #--filter限制IS-AUTOMATED或IS-OFFICIAL [root@localhost ~]# docker search --filter is-automated=false --filter is-official=false mysql INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/centos/mysql-57-centos7 MySQL 5.7 SQL database server 71 docker.io docker.io/mysql/mysql-cluster Experimental MySQL Cluster Docker images. ... 66 docker.io docker.io/tutum/mysql Base docker image to run a MySQL database ... 34 docker.io docker.io/linuxserver/mysql A Mysql container, brought to you by Linux... 24 docker.io docker.io/centos/mysql-56-centos7 MySQL 5.6 SQL database server 19 docker.io docker.io/circleci/mysql MySQL is a widely used, open-source relati... 19 docker.io docker.io/mysql/mysql-router MySQL Router provides transparent routing ... 14 docker.io docker.io/databack/mysql-backup Back up mysql databases to... anywhere! 13 docker.io docker.io/openshift/mysql-55-centos7 DEPRECATED: A Centos7 based MySQL v5.5 ima... 6 docker.io docker.io/devilbox/mysql Retagged MySQL, MariaDB and PerconaDB offi... 2 docker.io docker.io/jelastic/mysql An image of the MySQL database server main... 1 docker.io docker.io/monasca/mysql-init A minimal decoupled init container for mysql 0 #-s限制star数 [root@localhost ~]# docker search mysql -s 5000 Flag --stars has been deprecated, use --filter=stars=3 instead INDEX NAME DESCRIPTION STARS OFFICIAL AUTOMATED docker.io docker.io/mysql MySQL is a widely used, open-source relati... 9289 [OK] #拉取镜像命令,镜像名:版本号\t如果不加版本号默认最新版本 [root@localhost /]# docker pull mysql Using default tag: latest Trying to pull repository docker.io/library/mysql ... Get https://registry-1.docker.io/v2/: net/http: request canceled (Client.Timeout exceeded while awaiting headers) #docker的默认源在国外，响应时间过长，拉取被取消 #可以修改docker的镜像源，文件位置在 /etc/docker/daemon.json #修改为使用网易的docker镜像源 { \"registry-mirrors\": [\"http://hub-mirror.c.163.com\"] } #修改后再次拉取，不加版本默认lastest版本 [root@localhost /]# docker pull mysql Using default tag: latest Trying to pull repository docker.io/library/mysql ... latest: Pulling from docker.io/library/mysql 68ced04f60ab: Pull complete f9748e016a5c: Pull complete da54b038fed1: Pull complete 6895ec5eb2c0: Pull complete 111ba0647b87: Pull complete c1dce60f2f1a: Pull complete 702ec598d0af: Pull complete 4aba2fcbe869: Pull complete b26bbbd533e6: Pull complete 7bd100a66c55: Pull complete 74149336419a: Pull complete 145ea1f01648: Pull complete Digest: sha256:4a30434ce03d2fa396d0414f075ad9ca9b0b578f14ea5685e24dcbf789450a2c Status: Downloaded newer image for docker.io/mysql:latest #查看本地镜像,默认显示隐藏中间镜像,可带参数 -a --digests --no-trunc -q\t-q表示显示镜像id [root@localhost /]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE docker.io/mysql latest 9b51d9275906 2 weeks ago 547 MB [root@localhost ~]# docker images -q 9b51d9275906 #删除镜像docker rmi -f 镜像ID或docker rmi -f 镜像ID：TAG或docker rmi -f 镜像ID：TAG 镜像ID：TAG [root@localhost ~]# docker rmi -f 9b51d9275906 Untagged: docker.io/mysql:latest Untagged: docker.io/mysql@sha256:4a30434ce03d2fa396d0414f075ad9ca9b0b578f14ea5685e24dcbf789450a2c Deleted: sha256:9b51d9275906910446e03bb86e16a0fe0051d6518ba7ae39c8780fc2323fd637 Deleted: sha256:3b5f20d41feb31513164dab347e9f5bea57dc9c644819aeea2dd5cbb7c7213bf Deleted: sha256:0c9402cadbef6d34b3c8db27a0d793011c2de41cabc14354734752ec7bd325c1 Deleted: sha256:177c77529402c2687f69bb1cb16c1d6c82351e9f0ab5e7729d48ffab311b85be Deleted: sha256:67ef0899247f5e0163e7592aeff6a5ecfe644a67e465c207234153ff8ffc5be0 Deleted: sha256:85437a1ff817195eff1881a5b2d12bc0e17fa299cbba52cc6e2bb23f27d160bd Deleted: sha256:1dc77e60e1b82d40abf76f305b0854f0e3ad0352f7e18372344b955b84dfe9f5 Deleted: sha256:f145e1f715e622fbdb1677a24ca723e52a4bd921ad656faab61f537d3f326c4a Deleted: sha256:b1dbb44d9f303b7b24defc06cc8b6c58a38a0c3ed7e917adc309d5a75926dace Deleted: sha256:c92180bc575fea05e5dd83cbad7d2fd1852732f162b00818b101b2baabda04ac Deleted: sha256:c8420ebfba3078cd14bed76ee7d244b6ce4abad47f4f4843682eea6f03bd575e Deleted: sha256:bbb9cccab59a16cb6da78f8879e9d07a19e3a8d49010ab9c98a2c348fa116c87 Deleted: sha256:f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da #使用docker rmi -f $(docker images -q) $(docker images -q)即查出所用镜像ID，再进行删除 [root@localhost ~]# docker rmi -f $(docker images -q) Untagged: docker.io/tomcat:latest Untagged: docker.io/tomcat@sha256:b707d3b8b4f40951ca2f387c24ab9f78800c69c90740f0cca937a1b95204b3a4 Deleted: sha256:a7fa4ac97be4e70160f145599507a72b1ce91c4ceeb7ba164b757a631419b0d6 Deleted: sha256:76b28be2f8143a7c6a2e157cdf2b35130910f17aa8a4acfbea7c8a7d14c89d72 Deleted: sha256:17581028ef98984e5ce75b03ddc1ff4cb39d3378fe5d11a4eca94af3f998ff93 Deleted: sha256:e92ef8cef8f8f4531a678cee9d5cfda64cd2da64306d1c35e1611a7b0141d38b Deleted: sha256:5f7dc856e7f86af866f8248c928085fa93378d31ad8cc2af5f979874d2eec86a Deleted: sha256:ac3fa431f3550b5e1fc12ff79543a6426eff374fbf83917a038e7ec9a4f5eb2c Deleted: sha256:3072865e3a6e7586b8d1b4f30a1e610d1ac6d073d24728ca8043add4e9cd220f Deleted: sha256:9fdf9669f254a9165f7bbcaf4b4bd7b2b13f330e9ba24c44196a8864515fe8f1 Deleted: sha256:a7b99d1f9971254f00f4260842ca6280291150f3e181a045447f1dfc82b028cb Deleted: sha256:e26c0a912839cb72ad7ee298a3b850e8b80bf10d7f9236ca418aee240270fde1 Deleted: sha256:1c76bd0dc3255e65f07a8a5f12cecc85b2a9866bb5b33528462c83e1c1e48ab4 Docker容器命令 #使用镜像新建并启动容器docker run [OPTIONS] IMAGE [COMMAND] [ARG] OPTIONSkex可选参数，有--name为容器命名，-d以后台进程方式启动，-i以交互式方式启动容器，-t为容器分配一个伪终端，-p指定端口映射形式为hostPort：containerPort, -e指定容器启动后容器内的环境变量， --network可以指定启动的容器使用哪个docker network会自动分配ip，并且设置了容器名和ip的映射关系 #使用docker run -v指定挂载时，不能用相对目录，如 docker run -v config.xml:/etc/config.xml xxx 会报错 改为：docker run -v $PWD/config.xml:/etc/config.xml xxx [root@localhost ~]# docker run -it centos /bin/bash #退出容器exit为直接退出，退出后容器停止，使用ctrl+P+Q退出会容器会在后台运行 [root@12133e6bd7f1 /]# exit exit #对于foreground容器，由于其只是在开发调试过程中短期运行，其用户数据并无保留的必要，因而可以在容器启动时设置--rm选项，这样在容器退出时就能够自动清理容器内部的文件系统 #docker run -w path -w参数用于指定工作目录 [root@localhost ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@localhost ~]# [root@238d3fc941cb /]# [root@localhost ~]# [root@localhost ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 238d3fc941cb centos \"/bin/bash\" 13 seconds ago Up 11 seconds romantic_davinci #启动停止的容器 [root@localhost ~]# docker start 12133e6bd7f1 12133e6bd7f1 [root@localhost ~]# #停止容器 [root@localhost ~]# docker stop 12133e6bd7f1 12133e6bd7f1 #重启容器 [root@localhost ~]# docker restart 12133e6bd7f1 12133e6bd7f1 #强制停止容器 [root@localhost ~]# docker kill 12133e6bd7f1 12133e6bd7f1 #删除镜像docker rm -f 镜像ID或docker -rm -f $(docker ps -qa)删除所有镜像 [root@localhost ~]# docker rm -f $(docker ps -qa) 238d3fc941cb 12133e6bd7f1 #查看容器日志docker logs 容器ID -t -f --tail -t表示打印时间戳，-f表示跟随打印最新消息，--tail表示显示多少行 [root@localhost ~]# docker logs -f 6ec5b1ff99b8 25-Mar-2020 07:07:16.350 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version name: Apache Tomcat/8.5.53 25-Mar-2020 07:07:16.361 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built: Mar 11 2020 10:01:39 UTC 25-Mar-2020 07:07:16.361 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version number: 8.5.53.0 25-Mar-2020 07:07:16.361 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name: Linux 25-Mar-2020 07:07:16.361 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version: 3.10.0-1062.el7.x86_64 #--since指定查询指定时间之后的日志 --until指定查询时间之前的日志 时间戳必须是 2021-12-15T12:56:30.309227015Z 这种格式 docker logs --since=2021-12-15T12:56:30.309227015Z --until=2021-12-15T12:56:30.309227015Z xxx #如果你使用 grep 会发现根本不起作用，因为 docker logs 命令并没有将日志打印到标准输出，这里我们需要先重定向下。 docker logs 2\u003e\u00261 | grep 'grep thing' #以命令交互的方式进入正在运行的容器docker exec -it 容器ID /bin/bash或docker attach 容器ID [root@localhost ~]# docker attach 61872b9e7bb5 [root@61872b9e7bb5 /]# [root@localhost ~]# docker exec -it 61872b9e7bb5 /bin/bash [root@61872b9e7bb5 /]# 使用别名访问容器\ndocker run -it --name centos-1 docker.io/centos:latest docker run -it --name centos-2 --link centos-1:centos-1 docker.io/centos:latest --link：参数中第一个centos-1是容器名，第二个centos-1是定义的容器别名（使用别名访问容器），为了方便使用，一般别名默认容器名。 设置docker容器自启动\n#这种方式设置的自启动是docker restart/start 之后容器自启动，不是docker stop之后 #开启容器自启动 docker update cf877cb5ea48 9120211fed93 --restart=always #关闭容器自启动 docker update cf877cb5ea48 9120211fed93 --restart=no 删除所有已经停止运行的容器\n#查找出所有已经停止运行容器的ID,awk是linux下的一个文本分析工具，print $1 是打印安装tab分割每一行后的第一个参数 docker ps -a|grep Exited|awk '{print $1}' #删除 docker rm -f `docker ps -a|grep Exited|awk '{print $1}'` docker构建镜像 docker build -t 镜像名：版本号 -f Dockerfile文件地址 .\n最有一个 . 代表上下文路径，即在构建镜像的时候会把该目录下的文件拷贝到镜像中\n#创建Dockerfile文件 # build FROM golang AS build WORKDIR /gowork ADD . . ENV GOPROXY=https://goproxy.cn,direct ENV GOOS=linux #要使用alpine运行二进制必须指定 CGO_ENABLED=0 RUN CGO_ENABLED=0 go build -mod=mod -o /gowork/driver-weighing-adapter FROM alpine:3.9 # Define maintainer directories. MAINTAINER litao \"taoli@yunify.com\" # Define working directory. WORKDIR /data COPY --from=build /gowork/driver-weighing-adapter . # Define default command. ENTRYPOINT [\"/data/driver-weighing-adapter\",\"serve\"] #构建镜像,注意版本号有v docker build -f Dockerfile -t dockerhub.qingcloud.com/iot_demo/driver-weighing-adapter:v0.31 . #登录私有仓库 docker login -u hexing dockerhub.qingcloud.com hexing #推送镜像到私有仓库 docker push dockerhub.qingcloud.com/iot_demo/driver-weighing-adapter:v0.31 network 在docker中程序都使用docker来部署，一个程序可能要使用mysql、redis、es等，那么如何使部署在docker中的程序能够连接到mysql、redis、es呢，这就需要使用到网络了，使用docker network ls可以查看已经创建好的docker网络，最常使用的bridge模式，该模式的工作原理是建立一个docker0网桥，给这个网桥分配一段私有ip地址，在启动容器时如果使用该docker网络，那么会创建一对网口，一个网口位于docker容器内部为eth0，另一个网口在网桥上为vthxxx，在这一对网口的任一口通信另一个都能收到，所以当多个容器都使用同一个docker network那么就可以进行通信了\n#查看docker网络 docker network ls #创建docker网络，其中-d用于指定网络的类型，可以省略默认为bridge docker network create -d bridge networkname #删除docker网络 docker network rm networkname #查看docker网络细节，如有哪些容器使用了该网络，他们分配到的ip是多少 docker network inspect dnetworkname #删除所有未使用的docker 网络 docker network prune volume #查看存在的数据卷 docker volume ls #查看volume细节 docker volume inspect volumename #创建volume,会在/var/lib/docker/volumes/volumename/_data创建挂载点用于和容器内部连接 docker volume create volumename #删除volume docker volume rm volumename #删除未使用的volume docker volume prune 配置docker镜像仓库加速 cd /etc/docker vim /etc/docker/daemon.json { \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\",\"http://hub-mirror.c.163.com\",\"https://registry.docker-cn.com\"] } :wq systemctl daemon-reload systemctl restart docker Dockerfile FROM 指定构建的镜像是基于哪个镜像\nRUN 用于执行命令，主要有两种格式：RUN command，相当于./command; RUN [\"./command.sh\", “arg1”, “arg2”],相当于 ./command.sh arg1 arg2，每执行一条RUN docker在构建时都会构建一层镜像，所以过多无意义的层会导致最终构建的镜像庞大，所以有必要将多条RUN压缩成一条\nRUN ./command1.sh arg1 \\ \u0026\u0026 ./command2.sh arg1 arg2 COPY 从上下文路径中把文件或目录复制到容器中的指定路径，如果COPY的文件不在上下文中，在docker build的时候会构建失败COPY failed: file not found in build context or excluded by .dockerignore\nCOPY中源路径不可使用绝对路径，如要把当前上下文中的某个子文件拷贝进容器，使用COPY ./xxx/yyy/ /root 、 COPY xxx/yyy/ /root、COPY xxx/yyy /root都可以,但是不可以使用COPY xxx/yyy .该命令会把yyy文件夹下的文件拷贝到WORKDIR而不是把yyy文件夹拷贝到WORKDIR\n注意文件是不是在 .dockerignore 文件中申明了\nCOPY [--chown=:] \u003c源路径\u003e \u003c目标路径\u003e --chown可选参数可以改变拷贝到容器中文件的所有者和所属组 文件路径支持通配符 ADD 和COPY命令类似，不同的是ADD会把tar压缩文件解压后复制到容器中的指定路径\nCMD 和RUN一样都是用来运行命令，但不同的是RUN是在docker build 的时候执行，而CMD是docker run的时候执行，当Dockerfile中有多个CMD命令时，仅最后一个生效，CMD命令会被docker run时指定的参数所覆盖\nENTRYPOINT\nENTRYPOINT [\"\", \"\", \"\"] FROM nginx ENTRYPOINT [\"nginx\", \"-c\"] # 定参 CMD [\"/etc/nginx/nginx.conf\"] # 变参,会被 docker run -it -p 80:80 nginx -c /root/nginx.conf 覆盖 #该Dockerfile写法有问题，定义ENTRYPOINT、CMD会破坏父镜像nginx中的ENTRYPOINT、CMD导致nginx无法启动 ENV 设置环境变量,设置的环境变量可以通过$key 在Dockerfile中引用\nENV ENV = = ... ARG 和ENV类似，不过ARG的作用域仅为Dockerfile，构建好的容器中并不会有该环境变量\nFROM busybox ARG arg1 arg2 ARG user docker build --build-arg user=what_user --build-arg arg1=value1 --build-arg arg2=value2 . 应用案例：通过 --build-arg 在构建镜像时传递参数使得二进制中包含版本信息\nFROM golang:1.17 as builder ARG VERSION GIT_DIR GIT_COMMIT GIT_BRANCH BUILD_DATE WORKDIR /workspace # Copy the Go Modules manifests COPY go.mod go.mod COPY go.sum go.sum # cache deps before building and copying source so that we don't need to re-download as much # and so that source changes don't invalidate our downloaded layer ENV GO111MODULE=on CGO_ENABLED=0 GOOS=linux GOARCH=amd64 GOPROXY=https://goproxy.cn,direct RUN go mod download # Copy the go source COPY main.go main.go COPY pkg/ pkg/ # Build RUN go build -gcflags \"all=-N -l\" -ldflags \"-X $GIT_DIR/pkg/version.Version=$VERSION -X $GIT_DIR/pkg/version.BuildDate=$BUILD_DATE -X $GIT_DIR/pkg/version.GitCommit=$GIT_COMMIT -X $GIT_DIR/pkg/version.GitBranch=$GIT_BRANCH\" -a -o manager main.go 构建镜像的时候传递版本信息\ndocker build -t ${IMG} --build-arg VERSION=${VERSION} --build-arg GIT_DIR=${GIT_DIR} --build-arg GIT_COMMIT=${GIT_COMMIT} --build-arg GIT_BRANCH=${GIT_BRANCH} --build-arg BUILD_DATE=${BUILD_DATE} . VOLUME 定义匿名数据卷，避免容器重启数据丢失，避免容器过大,用过这种方式指定的都是容器内的挂载点，无法指定宿主机的源目录，所以在构建成功启动容器后要使用docker inspect去查看挂在目录的Source\nVOLUME [\"\", \"\"] EXPOSE 申明容器内部端口，用于在docker run -P 时会随机选用宿主机端口映射到这些容器内什么的端口 EXPOSE WORKDIR 指定工作目录，当docker容器启动时就在该目录下 docker compose 在https://github.com/docker/compose/releases去下载 赋予执行权限 移动到/usr/bin下 使用docker-compose verison验证 编写docker-compose文件\nvim docker-compose.yml 1 version: \"3.0\" 2 3 services: 4 tomcat: container_name: tomcat1 #相当于docker run 的 --name，指定了container_name后在同一个网桥中的容器可以使用 container_name代替ip 5 image: tomcat 6 ports: 7 - 8080:8080 volumes: #相当于docker run 的 -v - /root/webapps:/usr/local/tomcat/webapps networks: #相当于docker run的--network - hello #代表当前服务使用那么网桥 command: \"xxxx\" #覆盖容器默认命令 networks： #定义服务使用的网桥 hello： #创建网桥，默认为bridge，默认名称为项目名_网桥名 external: true #使用外部网桥，但是网桥必须存在，docker network -d bridge hello :wq portainer #安装 docker pull portainer/portainer #创建volume用于保存portainer的数据 docker volume create portainer_data #运行,-p 9000:9000用于映射portainer内部web访问页面，-v portainer_data:/data用于保存portainer数据，-v /var/run/docker.sock:/var/run/docker.sock用于映射docker的管理套接字到portainer内部来获取docker信息 docker run -d -p 9000:9000 -v portainer_data:/data -v /var/run/docker.sock:/var/run/docker.sock --name docker_portainer portainer/portainer namespace #lsns命令可以查看指定类型的namespace下的进程 lsns -t #查看容器的pid号 docker inpsect xxx |grep -i pid #nsenter进入到指定pid号的进程的指定namespace中执行命令 nsenter -t --mount --uts --ipc --net --pid -user ip addr 使用阿里云代理拉取gcr docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/{group}-{project} docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/{group}-{project} gcr.io/{group}/{project} docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/{group}-{project} ","wordCount":"1534","inLanguage":"en","datePublished":"2022-11-27T16:14:14+08:00","dateModified":"2022-11-27T16:14:14+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://moyuduo.github.io/posts/docker%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BD%BF%E7%94%A8/"},"publisher":{"@type":"Organization","name":"Moyuduo's Blog","logo":{"@type":"ImageObject","url":"https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://moyuduo.github.io/ accesskey=h title="Moyuduo's Blog (Alt + H)"><img src=https://moyuduo.github.io/apple-touch-icon.png alt aria-label=logo height=35>Moyuduo's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://moyuduo.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://moyuduo.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://moyuduo.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://moyuduo.github.io/posts/>Posts</a></div><h1 class=post-title>Docker简介及使用</h1><div class=post-meta><span title='2022-11-27 16:14:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1534 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h1 id=docker相关>Docker相关<a hidden class=anchor aria-hidden=true href=#docker相关>#</a></h1><h2 id=为什么要使用docker>为什么要使用Docker？<a hidden class=anchor aria-hidden=true href=#为什么要使用docker>#</a></h2><p>想想在分布式项目中，Nginx后会有很多的服务器提供服务，并且当一些特殊的情况下我们需要对服务器进行扩容，假如我们要新增100台服务器，我们需要一个一个服务器都去装tomcat吗？每台都去进行相关配置吗？再想想我们学习开源项目，很多情况下都需要安装Mysql、Redis、MongoDB、Tomcat等，这时候一个一个去装，一个个去配置是不是很麻烦，Docker就为我们提供了一个简洁的方式完成这些工作。</p><h2 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h2><p>Docker是一个开源的应用容器引擎；是一个轻量级容器技术；</p><p>Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；</p><p>运行中的这个镜像称为容器，容器启动是非常快速的。</p><h2 id=核心概念>核心概念<a hidden class=anchor aria-hidden=true href=#核心概念>#</a></h2><p>docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；</p><p>docker客户端(Client)：连接docker主机进行操作；</p><p>docker仓库(Registry)：用来保存各种打包好的软件镜像；</p><p>docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</p><p>docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用；</p><h2 id=安装docker>安装Docker<a hidden class=anchor aria-hidden=true href=#安装docker>#</a></h2><p>1）可以使用VmWare或VirtualBox</p><p>2）安装好centos，内核版本必须是3.1以上，可以使用uname -r查看</p><p>3）配置好网络，保证能连上外网</p><p>4）使用yum命令安装docker</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum install docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum list installed<span class=p>|</span>grep docker
</span></span><span class=line><span class=cl><span class=c1>#卸载原有的docker</span>
</span></span><span class=line><span class=cl>yum remove -y docker-ce docker-ce-cli docker-ce-rootless-extras docker-scan-plugin containerd.io
</span></span><span class=line><span class=cl><span class=c1>#删除镜像、容器、配置文件等内容</span>
</span></span><span class=line><span class=cl>rm -rf /var/lib/docker
</span></span><span class=line><span class=cl><span class=c1>#查询docker可按照版本</span>
</span></span><span class=line><span class=cl>yum list docker-ce --showduplicates <span class=p>|</span> sort -r
</span></span><span class=line><span class=cl><span class=c1># !!!亲测centos7.2下安装这个版本不会有问题</span>
</span></span><span class=line><span class=cl>yum install -y docker-ce-17.06.2.ce-1.el7.centos
</span></span><span class=line><span class=cl>20.10.7-3
</span></span><span class=line><span class=cl>yum install -y docker-ce-20.10.7-3.el7.x86_64 containerd.io
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl start docker
</span></span><span class=line><span class=cl>docker run hello-world
</span></span></code></pre></div><p>5)安装的过程中会提示是否继续？[y/N]：y 输入y即可 最后出现完毕!即完成</p><h2 id=启动docker>启动Docker<a hidden class=anchor aria-hidden=true href=#启动docker>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#启动docker</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost yum.repos.d<span class=o>]</span><span class=c1># systemctl start docker</span>
</span></span><span class=line><span class=cl><span class=c1>#查看docker版本</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost yum.repos.d<span class=o>]</span><span class=c1># docker -v</span>
</span></span><span class=line><span class=cl>Docker version 1.13.1, build cccb291/1.13.1
</span></span><span class=line><span class=cl><span class=c1>#设置docker开机自启动</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost yum.repos.d<span class=o>]</span><span class=c1># systemctl enable docker</span>
</span></span><span class=line><span class=cl>Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.
</span></span><span class=line><span class=cl><span class=c1>#停止docker</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost yum.repos.d<span class=o>]</span><span class=c1># systemctl stop docker</span>
</span></span></code></pre></div><h2 id=docker常用命令>Docker常用命令<a hidden class=anchor aria-hidden=true href=#docker常用命令>#</a></h2><p>参考<a href=docs.docker.com>docs.docker.com</a></p><h3 id=docker镜像命令>Docker镜像命令<a hidden class=anchor aria-hidden=true href=#docker镜像命令>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#镜像搜索命令</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker search mysql</span>
</span></span><span class=line><span class=cl>INDEX       NAME                                        DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql                             MySQL is a widely used, open-source relati...   <span class=m>9286</span>      <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>docker.io   docker.io/mariadb                           MariaDB is a community-developed fork of M...   <span class=m>3315</span>      <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql/mysql-server                Optimized MySQL Server Docker images. Crea...   <span class=m>682</span>                  <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl>docker.io   docker.io/centos/mysql-57-centos7           MySQL 5.7 SQL database server                   <span class=m>71</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql/mysql-cluster               Experimental MySQL Cluster Docker images. ...   <span class=m>66</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/centurylink/mysql                 Image containing mysql. Optimized to be li...   <span class=m>61</span>                   <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl>docker.io   docker.io/deitch/mysql-backup               REPLACED! Please use http://hub.docker.com...   <span class=m>41</span>                   <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl>docker.io   docker.io/bitnami/mysql                     Bitnami MySQL Docker Image                      <span class=m>36</span>                   <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1>#在搜索容器时可以加上--no-trunc --automated	--limit --filter或-f  -s 参数	--no-trunc是值显示完整的镜像描述	--automated是搜索自动构建的项目 -s 10 表示搜索出的项目star大于等于10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#--no-trunc</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker search mysql --no-trunc</span>
</span></span><span class=line><span class=cl>INDEX       NAME                                        DESCRIPTION                                                                                           STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql                             MySQL is a widely used, open-source relational database management system <span class=o>(</span>RDBMS<span class=o>)</span>.                    <span class=m>9289</span>      <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>docker.io   docker.io/mariadb                           MariaDB is a community-developed fork of MySQL intended to remain free under the GNU GPL.             <span class=m>3316</span>      <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl><span class=c1>#--automated</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker search mysql --automated</span>
</span></span><span class=line><span class=cl>Flag --automated has been deprecated, use --filter<span class=o>=</span><span class=nv>automated</span><span class=o>=</span><span class=nb>true</span> instead
</span></span><span class=line><span class=cl>INDEX       NAME                                        DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql/mysql-server                Optimized MySQL Server Docker images. Crea...   <span class=m>683</span>                  <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl>docker.io   docker.io/centurylink/mysql                 Image containing mysql. Optimized to be li...   <span class=m>61</span>                   <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1>#limit限制搜索出的结果条数</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker search --limit 3 mysql</span>
</span></span><span class=line><span class=cl>INDEX       NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql                MySQL is a widely used, open-source relati...   <span class=m>9289</span>      <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql/mysql-server   Optimized MySQL Server Docker images. Crea...   <span class=m>683</span>                  <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl>docker.io   docker.io/circleci/mysql       MySQL is a widely used, open-source relati...   <span class=m>19</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#--filter限制IS-AUTOMATED或IS-OFFICIAL</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker search --filter is-automated=false --filter is-official=false mysql</span>
</span></span><span class=line><span class=cl>INDEX       NAME                                   DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>docker.io   docker.io/centos/mysql-57-centos7      MySQL 5.7 SQL database server                   <span class=m>71</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql/mysql-cluster          Experimental MySQL Cluster Docker images. ...   <span class=m>66</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/tutum/mysql                  Base docker image to run a MySQL database ...   <span class=m>34</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/linuxserver/mysql            A Mysql container, brought to you by Linux...   <span class=m>24</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/centos/mysql-56-centos7      MySQL 5.6 SQL database server                   <span class=m>19</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/circleci/mysql               MySQL is a widely used, open-source relati...   <span class=m>19</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql/mysql-router           MySQL Router provides transparent routing ...   <span class=m>14</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/databack/mysql-backup        Back up mysql databases to... anywhere!         <span class=m>13</span>                   
</span></span><span class=line><span class=cl>docker.io   docker.io/openshift/mysql-55-centos7   DEPRECATED: A Centos7 based MySQL v5.5 ima...   <span class=m>6</span>                    
</span></span><span class=line><span class=cl>docker.io   docker.io/devilbox/mysql               Retagged MySQL, MariaDB and PerconaDB offi...   <span class=m>2</span>                    
</span></span><span class=line><span class=cl>docker.io   docker.io/jelastic/mysql               An image of the MySQL database server main...   <span class=m>1</span>                    
</span></span><span class=line><span class=cl>docker.io   docker.io/monasca/mysql-init           A minimal decoupled init container <span class=k>for</span> mysql    <span class=m>0</span>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#-s限制star数</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker search mysql -s 5000</span>
</span></span><span class=line><span class=cl>Flag --stars has been deprecated, use --filter<span class=o>=</span><span class=nv>stars</span><span class=o>=</span><span class=m>3</span> instead
</span></span><span class=line><span class=cl>INDEX       NAME              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>docker.io   docker.io/mysql   MySQL is a widely used, open-source relati...   <span class=m>9289</span>      <span class=o>[</span>OK<span class=o>]</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#拉取镜像命令,镜像名:版本号	如果不加版本号默认最新版本</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker pull mysql</span>
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span><span class=line><span class=cl>Trying to pull repository docker.io/library/mysql ... 
</span></span><span class=line><span class=cl>Get https://registry-1.docker.io/v2/: net/http: request canceled <span class=o>(</span>Client.Timeout exceeded <span class=k>while</span> awaiting headers<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>#docker的默认源在国外，响应时间过长，拉取被取消</span>
</span></span><span class=line><span class=cl><span class=c1>#可以修改docker的镜像源，文件位置在 /etc/docker/daemon.json</span>
</span></span><span class=line><span class=cl><span class=c1>#修改为使用网易的docker镜像源</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;registry-mirrors&#34;</span>: <span class=o>[</span><span class=s2>&#34;http://hub-mirror.c.163.com&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#修改后再次拉取，不加版本默认lastest版本</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker pull mysql</span>
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span><span class=line><span class=cl>Trying to pull repository docker.io/library/mysql ... 
</span></span><span class=line><span class=cl>latest: Pulling from docker.io/library/mysql
</span></span><span class=line><span class=cl>68ced04f60ab: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>f9748e016a5c: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>da54b038fed1: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>6895ec5eb2c0: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>111ba0647b87: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>c1dce60f2f1a: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>702ec598d0af: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>4aba2fcbe869: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>b26bbbd533e6: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>7bd100a66c55: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>74149336419a: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>145ea1f01648: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>Digest: sha256:4a30434ce03d2fa396d0414f075ad9ca9b0b578f14ea5685e24dcbf789450a2c
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> docker.io/mysql:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#查看本地镜像,默认显示隐藏中间镜像,可带参数 -a --digests --no-trunc -q	-q表示显示镜像id</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker images</span>
</span></span><span class=line><span class=cl>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class=line><span class=cl>docker.io/mysql     latest              9b51d9275906        <span class=m>2</span> weeks ago         <span class=m>547</span> MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker images -q</span>
</span></span><span class=line><span class=cl>9b51d9275906
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除镜像docker rmi -f 镜像ID或docker rmi -f 镜像ID：TAG或docker rmi -f 镜像ID：TAG 镜像ID：TAG</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker rmi -f 9b51d9275906</span>
</span></span><span class=line><span class=cl>Untagged: docker.io/mysql:latest
</span></span><span class=line><span class=cl>Untagged: docker.io/mysql@sha256:4a30434ce03d2fa396d0414f075ad9ca9b0b578f14ea5685e24dcbf789450a2c
</span></span><span class=line><span class=cl>Deleted: sha256:9b51d9275906910446e03bb86e16a0fe0051d6518ba7ae39c8780fc2323fd637
</span></span><span class=line><span class=cl>Deleted: sha256:3b5f20d41feb31513164dab347e9f5bea57dc9c644819aeea2dd5cbb7c7213bf
</span></span><span class=line><span class=cl>Deleted: sha256:0c9402cadbef6d34b3c8db27a0d793011c2de41cabc14354734752ec7bd325c1
</span></span><span class=line><span class=cl>Deleted: sha256:177c77529402c2687f69bb1cb16c1d6c82351e9f0ab5e7729d48ffab311b85be
</span></span><span class=line><span class=cl>Deleted: sha256:67ef0899247f5e0163e7592aeff6a5ecfe644a67e465c207234153ff8ffc5be0
</span></span><span class=line><span class=cl>Deleted: sha256:85437a1ff817195eff1881a5b2d12bc0e17fa299cbba52cc6e2bb23f27d160bd
</span></span><span class=line><span class=cl>Deleted: sha256:1dc77e60e1b82d40abf76f305b0854f0e3ad0352f7e18372344b955b84dfe9f5
</span></span><span class=line><span class=cl>Deleted: sha256:f145e1f715e622fbdb1677a24ca723e52a4bd921ad656faab61f537d3f326c4a
</span></span><span class=line><span class=cl>Deleted: sha256:b1dbb44d9f303b7b24defc06cc8b6c58a38a0c3ed7e917adc309d5a75926dace
</span></span><span class=line><span class=cl>Deleted: sha256:c92180bc575fea05e5dd83cbad7d2fd1852732f162b00818b101b2baabda04ac
</span></span><span class=line><span class=cl>Deleted: sha256:c8420ebfba3078cd14bed76ee7d244b6ce4abad47f4f4843682eea6f03bd575e
</span></span><span class=line><span class=cl>Deleted: sha256:bbb9cccab59a16cb6da78f8879e9d07a19e3a8d49010ab9c98a2c348fa116c87
</span></span><span class=line><span class=cl>Deleted: sha256:f2cb0ecef392f2a630fa1205b874ab2e2aedf96de04d0b8838e4e728e28142da
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#使用docker rmi -f $(docker images -q) $(docker images -q)即查出所用镜像ID，再进行删除</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker rmi -f $(docker images -q)</span>
</span></span><span class=line><span class=cl>Untagged: docker.io/tomcat:latest
</span></span><span class=line><span class=cl>Untagged: docker.io/tomcat@sha256:b707d3b8b4f40951ca2f387c24ab9f78800c69c90740f0cca937a1b95204b3a4
</span></span><span class=line><span class=cl>Deleted: sha256:a7fa4ac97be4e70160f145599507a72b1ce91c4ceeb7ba164b757a631419b0d6
</span></span><span class=line><span class=cl>Deleted: sha256:76b28be2f8143a7c6a2e157cdf2b35130910f17aa8a4acfbea7c8a7d14c89d72
</span></span><span class=line><span class=cl>Deleted: sha256:17581028ef98984e5ce75b03ddc1ff4cb39d3378fe5d11a4eca94af3f998ff93
</span></span><span class=line><span class=cl>Deleted: sha256:e92ef8cef8f8f4531a678cee9d5cfda64cd2da64306d1c35e1611a7b0141d38b
</span></span><span class=line><span class=cl>Deleted: sha256:5f7dc856e7f86af866f8248c928085fa93378d31ad8cc2af5f979874d2eec86a
</span></span><span class=line><span class=cl>Deleted: sha256:ac3fa431f3550b5e1fc12ff79543a6426eff374fbf83917a038e7ec9a4f5eb2c
</span></span><span class=line><span class=cl>Deleted: sha256:3072865e3a6e7586b8d1b4f30a1e610d1ac6d073d24728ca8043add4e9cd220f
</span></span><span class=line><span class=cl>Deleted: sha256:9fdf9669f254a9165f7bbcaf4b4bd7b2b13f330e9ba24c44196a8864515fe8f1
</span></span><span class=line><span class=cl>Deleted: sha256:a7b99d1f9971254f00f4260842ca6280291150f3e181a045447f1dfc82b028cb
</span></span><span class=line><span class=cl>Deleted: sha256:e26c0a912839cb72ad7ee298a3b850e8b80bf10d7f9236ca418aee240270fde1
</span></span><span class=line><span class=cl>Deleted: sha256:1c76bd0dc3255e65f07a8a5f12cecc85b2a9866bb5b33528462c83e1c1e48ab4
</span></span></code></pre></div><h3 id=docker容器命令>Docker容器命令<a hidden class=anchor aria-hidden=true href=#docker容器命令>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#使用镜像新建并启动容器docker run [OPTIONS] IMAGE [COMMAND] [ARG] OPTIONSkex可选参数，有--name为容器命名，-d以后台进程方式启动，-i以交互式方式启动容器，-t为容器分配一个伪终端，-p指定端口映射形式为hostPort：containerPort, -e指定容器启动后容器内的环境变量， --network可以指定启动的容器使用哪个docker network会自动分配ip，并且设置了容器名和ip的映射关系</span>
</span></span><span class=line><span class=cl><span class=c1>#使用docker run -v指定挂载时，不能用相对目录，如 docker run -v config.xml:/etc/config.xml xxx 会报错 改为：docker run -v $PWD/config.xml:/etc/config.xml xxx</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker run -it centos /bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#退出容器exit为直接退出，退出后容器停止，使用ctrl+P+Q退出会容器会在后台运行</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@12133e6bd7f1 /<span class=o>]</span><span class=c1># exit</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#对于foreground容器，由于其只是在开发调试过程中短期运行，其用户数据并无保留的必要，因而可以在容器启动时设置--rm选项，这样在容器退出时就能够自动清理容器内部的文件系统</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#docker run -w path -w参数用于指定工作目录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker ps</span>
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@238d3fc941cb /<span class=o>]</span><span class=c1># [root@localhost ~]# </span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker ps</span>
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></span><span class=line><span class=cl>238d3fc941cb        centos              <span class=s2>&#34;/bin/bash&#34;</span>         <span class=m>13</span> seconds ago      Up <span class=m>11</span> seconds                           romantic_davinci
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#启动停止的容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker start 12133e6bd7f1</span>
</span></span><span class=line><span class=cl>12133e6bd7f1
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#停止容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker stop 12133e6bd7f1</span>
</span></span><span class=line><span class=cl>12133e6bd7f1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#重启容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker restart 12133e6bd7f1</span>
</span></span><span class=line><span class=cl>12133e6bd7f1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#强制停止容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker kill 12133e6bd7f1</span>
</span></span><span class=line><span class=cl>12133e6bd7f1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除镜像docker rm -f 镜像ID或docker -rm -f $(docker ps -qa)删除所有镜像</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker rm -f $(docker ps -qa)</span>
</span></span><span class=line><span class=cl>238d3fc941cb
</span></span><span class=line><span class=cl>12133e6bd7f1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#查看容器日志docker logs 容器ID -t -f --tail -t表示打印时间戳，-f表示跟随打印最新消息，--tail表示显示多少行</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker logs -f 6ec5b1ff99b8</span>
</span></span><span class=line><span class=cl>25-Mar-2020 07:07:16.350 INFO <span class=o>[</span>main<span class=o>]</span> org.apache.catalina.startup.VersionLoggerListener.log Server version name:   Apache Tomcat/8.5.53
</span></span><span class=line><span class=cl>25-Mar-2020 07:07:16.361 INFO <span class=o>[</span>main<span class=o>]</span> org.apache.catalina.startup.VersionLoggerListener.log Server built:          Mar <span class=m>11</span> <span class=m>2020</span> 10:01:39 UTC
</span></span><span class=line><span class=cl>25-Mar-2020 07:07:16.361 INFO <span class=o>[</span>main<span class=o>]</span> org.apache.catalina.startup.VersionLoggerListener.log Server version number: 8.5.53.0
</span></span><span class=line><span class=cl>25-Mar-2020 07:07:16.361 INFO <span class=o>[</span>main<span class=o>]</span> org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Linux
</span></span><span class=line><span class=cl>25-Mar-2020 07:07:16.361 INFO <span class=o>[</span>main<span class=o>]</span> org.apache.catalina.startup.VersionLoggerListener.log OS Version:            3.10.0-1062.el7.x86_64
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#--since指定查询指定时间之后的日志 --until指定查询时间之前的日志 时间戳必须是 2021-12-15T12:56:30.309227015Z 这种格式</span>
</span></span><span class=line><span class=cl>docker logs --since<span class=o>=</span>2021-12-15T12:56:30.309227015Z --until<span class=o>=</span>2021-12-15T12:56:30.309227015Z xxx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#如果你使用 grep 会发现根本不起作用，因为 docker logs 命令并没有将日志打印到标准输出，这里我们需要先重定向下。</span>
</span></span><span class=line><span class=cl>docker logs &lt;container-id&gt; 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>|</span> grep <span class=s1>&#39;grep thing&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#以命令交互的方式进入正在运行的容器docker exec -it 容器ID /bin/bash或docker attach 容器ID</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker attach 61872b9e7bb5</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@61872b9e7bb5 /<span class=o>]</span><span class=c1># </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># docker exec -it 61872b9e7bb5 /bin/bash</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@61872b9e7bb5 /<span class=o>]</span><span class=c1># </span>
</span></span></code></pre></div><p>使用别名访问容器</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker run -it --name centos-1 docker.io/centos:latest
</span></span><span class=line><span class=cl>docker run -it --name centos-2 --link centos-1:centos-1 docker.io/centos:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--link：参数中第一个centos-1是容器名，第二个centos-1是定义的容器别名（使用别名访问容器），为了方便使用，一般别名默认容器名。
</span></span></code></pre></div><p>设置docker容器自启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#这种方式设置的自启动是docker restart/start 之后容器自启动，不是docker stop之后</span>
</span></span><span class=line><span class=cl><span class=c1>#开启容器自启动</span>
</span></span><span class=line><span class=cl>docker update cf877cb5ea48 9120211fed93 --restart<span class=o>=</span>always
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#关闭容器自启动</span>
</span></span><span class=line><span class=cl>docker update cf877cb5ea48 9120211fed93 --restart<span class=o>=</span>no
</span></span></code></pre></div><p>删除所有已经停止运行的容器</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#查找出所有已经停止运行容器的ID,awk是linux下的一个文本分析工具，print $1 是打印安装tab分割每一行后的第一个参数</span>
</span></span><span class=line><span class=cl>docker ps -a<span class=p>|</span>grep Exited<span class=p>|</span>awk <span class=s1>&#39;{print $1}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除</span>
</span></span><span class=line><span class=cl>docker rm -f <span class=sb>`</span>docker ps -a<span class=p>|</span>grep Exited<span class=p>|</span>awk <span class=s1>&#39;{print $1}&#39;</span><span class=sb>`</span>
</span></span></code></pre></div><h3 id=docker构建镜像>docker构建镜像<a hidden class=anchor aria-hidden=true href=#docker构建镜像>#</a></h3><p>docker build -t 镜像名：版本号 -f Dockerfile文件地址 .</p><p>最有一个 . 代表上下文路径，即在构建镜像的时候会把该目录下的文件拷贝到镜像中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#创建Dockerfile文件</span>
</span></span><span class=line><span class=cl><span class=c1># build</span>
</span></span><span class=line><span class=cl>FROM golang AS build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WORKDIR /gowork
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ADD . . 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV <span class=nv>GOPROXY</span><span class=o>=</span>https://goproxy.cn,direct
</span></span><span class=line><span class=cl>ENV <span class=nv>GOOS</span><span class=o>=</span>linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#要使用alpine运行二进制必须指定 CGO_ENABLED=0 </span>
</span></span><span class=line><span class=cl>RUN <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> go build -mod<span class=o>=</span>mod -o /gowork/driver-weighing-adapter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>FROM alpine:3.9
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define maintainer directories.</span>
</span></span><span class=line><span class=cl>MAINTAINER litao <span class=s2>&#34;taoli@yunify.com&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define working directory.</span>
</span></span><span class=line><span class=cl>WORKDIR /data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COPY --from<span class=o>=</span>build /gowork/driver-weighing-adapter .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define default command.</span>
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;/data/driver-weighing-adapter&#34;</span>,<span class=s2>&#34;serve&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#构建镜像,注意版本号有v</span>
</span></span><span class=line><span class=cl>docker build -f Dockerfile -t dockerhub.qingcloud.com/iot_demo/driver-weighing-adapter:v0.31 .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#登录私有仓库</span>
</span></span><span class=line><span class=cl>docker login -u hexing dockerhub.qingcloud.com
</span></span><span class=line><span class=cl>hexing
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#推送镜像到私有仓库</span>
</span></span><span class=line><span class=cl>docker push dockerhub.qingcloud.com/iot_demo/driver-weighing-adapter:v0.31
</span></span></code></pre></div><h3 id=network>network<a hidden class=anchor aria-hidden=true href=#network>#</a></h3><p>在docker中程序都使用docker来部署，一个程序可能要使用mysql、redis、es等，那么如何使部署在docker中的程序能够连接到mysql、redis、es呢，这就需要使用到网络了，使用docker network ls可以查看已经创建好的docker网络，最常使用的bridge模式，该模式的工作原理是建立一个docker0网桥，给这个网桥分配一段私有ip地址，在启动容器时如果使用该docker网络，那么会创建一对网口，一个网口位于docker容器内部为eth0，另一个网口在网桥上为vthxxx，在这一对网口的任一口通信另一个都能收到，所以当多个容器都使用同一个docker network那么就可以进行通信了</p><p><img loading=lazy src=Snipaste_2021-09-26_21-57-14.jpg alt></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#查看docker网络</span>
</span></span><span class=line><span class=cl>docker network ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#创建docker网络，其中-d用于指定网络的类型，可以省略默认为bridge</span>
</span></span><span class=line><span class=cl>docker network create -d bridge networkname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除docker网络</span>
</span></span><span class=line><span class=cl>docker network rm networkname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#查看docker网络细节，如有哪些容器使用了该网络，他们分配到的ip是多少</span>
</span></span><span class=line><span class=cl>docker network inspect dnetworkname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除所有未使用的docker 网络</span>
</span></span><span class=line><span class=cl>docker network prune
</span></span></code></pre></div><h3 id=volume>volume<a hidden class=anchor aria-hidden=true href=#volume>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#查看存在的数据卷</span>
</span></span><span class=line><span class=cl>docker volume ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#查看volume细节</span>
</span></span><span class=line><span class=cl>docker volume inspect volumename
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#创建volume,会在/var/lib/docker/volumes/volumename/_data创建挂载点用于和容器内部连接</span>
</span></span><span class=line><span class=cl>docker volume create volumename
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除volume</span>
</span></span><span class=line><span class=cl>docker volume rm volumename
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#删除未使用的volume</span>
</span></span><span class=line><span class=cl>docker volume prune
</span></span></code></pre></div><h2 id=配置docker镜像仓库加速>配置docker镜像仓库加速<a hidden class=anchor aria-hidden=true href=#配置docker镜像仓库加速>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /etc/docker
</span></span><span class=line><span class=cl>vim /etc/docker/daemon.json
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;registry-mirrors&#34;</span>: <span class=o>[</span><span class=s2>&#34;https://docker.mirrors.ustc.edu.cn&#34;</span>,<span class=s2>&#34;http://hub-mirror.c.163.com&#34;</span>,<span class=s2>&#34;https://registry.docker-cn.com&#34;</span><span class=o>]</span>     
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>:wq
</span></span><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl restart docker
</span></span></code></pre></div><h2 id=dockerfile>Dockerfile<a hidden class=anchor aria-hidden=true href=#dockerfile>#</a></h2><ol><li><p>FROM 指定构建的镜像是基于哪个镜像</p></li><li><p>RUN 用于执行命令，主要有两种格式：RUN command，相当于<code>./command</code>; RUN ["./command.sh", &ldquo;arg1&rdquo;, &ldquo;arg2&rdquo;],相当于 <code>./command.sh arg1 arg2</code>，每执行一条RUN docker在构建时都会构建一层镜像，所以过多无意义的层会导致最终构建的镜像庞大，所以有必要将多条RUN压缩成一条</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>RUN ./command1.sh arg1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=o>&amp;&amp;</span> ./command2.sh arg1 arg2
</span></span></code></pre></div></li><li><p>COPY 从上下文路径中把文件或目录复制到容器中的指定路径，如果COPY的文件不在上下文中，在docker build的时候会构建失败COPY failed: file not found in build context or excluded by .dockerignore</p><p>COPY中源路径<strong>不可使用绝对路径</strong>，如要把当前上下文中的某个子文件拷贝进容器，使用<code>COPY ./xxx/yyy/ /root</code> 、 <code>COPY xxx/yyy/ /root</code>、<code>COPY xxx/yyy /root</code>都可以,但是不可以使用<code>COPY xxx/yyy .</code>该命令会把<code>yyy</code>文件夹下的文件拷贝到<code>WORKDIR</code>而不是把<code>yyy</code>文件夹拷贝到<code>WORKDIR</code></p><p><strong>注意文件是不是在 .dockerignore 文件中申明了</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>COPY <span class=o>[</span>--chown<span class=o>=</span>&lt;user&gt;:&lt;group&gt;<span class=o>]</span> &lt;源路径&gt; &lt;目标路径&gt;
</span></span><span class=line><span class=cl>--chown可选参数可以改变拷贝到容器中文件的所有者和所属组
</span></span><span class=line><span class=cl>文件路径支持通配符
</span></span></code></pre></div></li><li><p>ADD 和COPY命令类似，不同的是ADD会把tar压缩文件解压后复制到容器中的指定路径</p></li><li><p>CMD 和RUN一样都是用来运行命令，但不同的是RUN是在docker build 的时候执行，而CMD是docker run的时候执行，当Dockerfile中有多个CMD命令时，仅最后一个生效，CMD命令会被docker run时指定的参数所覆盖</p></li><li><p>ENTRYPOINT</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;&lt;executeable&gt;&#34;</span>, <span class=s2>&#34;&lt;param1&gt;&#34;</span>, <span class=s2>&#34;&lt;param2&gt;&#34;</span><span class=o>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>FROM nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;nginx&#34;</span>, <span class=s2>&#34;-c&#34;</span><span class=o>]</span> <span class=c1># 定参</span>
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;/etc/nginx/nginx.conf&#34;</span><span class=o>]</span> <span class=c1># 变参,会被 docker run -it -p 80:80 nginx -c /root/nginx.conf 覆盖</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#该Dockerfile写法有问题，定义ENTRYPOINT、CMD会破坏父镜像nginx中的ENTRYPOINT、CMD导致nginx无法启动</span>
</span></span></code></pre></div></li><li><p>ENV 设置环境变量,设置的环境变量可以通过$key 在Dockerfile中引用</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ENV &lt;key&gt; &lt;val&gt;
</span></span><span class=line><span class=cl>ENV &lt;key1&gt;<span class=o>=</span>&lt;val1&gt; &lt;key2&gt;<span class=o>=</span>&lt;val2&gt; ...
</span></span></code></pre></div><ol start=8><li><p>ARG 和ENV类似，不过ARG的作用域仅为Dockerfile，构建好的容器中并不会有该环境变量</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>FROM busybox
</span></span><span class=line><span class=cl>ARG arg1 arg2
</span></span><span class=line><span class=cl>ARG user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker build --build-arg <span class=nv>user</span><span class=o>=</span>what_user --build-arg <span class=nv>arg1</span><span class=o>=</span>value1 --build-arg <span class=nv>arg2</span><span class=o>=</span>value2 .
</span></span></code></pre></div><p>应用案例：通过 <code>--build-arg</code> 在构建镜像时传递参数使得二进制中包含版本信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> golang:1.17 as builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> VERSION GIT_DIR GIT_COMMIT GIT_BRANCH BUILD_DATE<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /workspace</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy the Go Modules manifests</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> go.mod go.mod<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> go.sum go.sum<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># cache deps before building and copying source so that we don&#39;t need to re-download as much</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># and so that source changes don&#39;t invalidate our downloaded layer</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> <span class=nv>GOOS</span><span class=o>=</span>linux <span class=nv>GOARCH</span><span class=o>=</span>amd64 <span class=nv>GOPROXY</span><span class=o>=</span>https://goproxy.cn,direct<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> go mod download<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy the go source</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> main.go main.go<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> pkg/ pkg/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> go build -gcflags <span class=s2>&#34;all=-N -l&#34;</span> -ldflags <span class=s2>&#34;-X </span><span class=nv>$GIT_DIR</span><span class=s2>/pkg/version.Version=</span><span class=nv>$VERSION</span><span class=s2> -X </span><span class=nv>$GIT_DIR</span><span class=s2>/pkg/version.BuildDate=</span><span class=nv>$BUILD_DATE</span><span class=s2> -X </span><span class=nv>$GIT_DIR</span><span class=s2>/pkg/version.GitCommit=</span><span class=nv>$GIT_COMMIT</span><span class=s2> -X </span><span class=nv>$GIT_DIR</span><span class=s2>/pkg/version.GitBranch=</span><span class=nv>$GIT_BRANCH</span><span class=s2>&#34;</span> -a -o manager main.go<span class=err>
</span></span></span></code></pre></div><p>构建镜像的时候传递版本信息</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker build -t <span class=si>${</span><span class=nv>IMG</span><span class=si>}</span> --build-arg <span class=nv>VERSION</span><span class=o>=</span><span class=si>${</span><span class=nv>VERSION</span><span class=si>}</span> --build-arg <span class=nv>GIT_DIR</span><span class=o>=</span><span class=si>${</span><span class=nv>GIT_DIR</span><span class=si>}</span> --build-arg <span class=nv>GIT_COMMIT</span><span class=o>=</span><span class=si>${</span><span class=nv>GIT_COMMIT</span><span class=si>}</span> --build-arg <span class=nv>GIT_BRANCH</span><span class=o>=</span><span class=si>${</span><span class=nv>GIT_BRANCH</span><span class=si>}</span> --build-arg <span class=nv>BUILD_DATE</span><span class=o>=</span><span class=si>${</span><span class=nv>BUILD_DATE</span><span class=si>}</span> .
</span></span></code></pre></div></li><li><p>VOLUME 定义匿名数据卷，避免容器重启数据丢失，避免容器过大,用过这种方式指定的都是容器内的挂载点，无法指定宿主机的源目录，所以在构建成功启动容器后要使用docker inspect去查看挂在目录的Source</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>VOLUME <span class=o>[</span><span class=s2>&#34;&lt;path1&gt;&#34;</span>, <span class=s2>&#34;&lt;path2&gt;&#34;</span><span class=o>]</span>
</span></span></code></pre></div><ol start=11><li>EXPOSE 申明容器内部端口，用于在docker run -P 时会随机选用宿主机端口映射到这些容器内什么的端口</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>EXPOSE &lt;port1&gt; &lt;port2&gt;
</span></span></code></pre></div><ol start=11><li>WORKDIR 指定工作目录，当docker容器启动时就在该目录下</li></ol><h2 id=docker-compose>docker compose<a hidden class=anchor aria-hidden=true href=#docker-compose>#</a></h2><ol><li>在https://github.com/docker/compose/releases去下载</li><li>赋予执行权限</li><li>移动到<code>/usr/bin</code>下</li><li>使用<code>docker-compose verison</code>验证</li></ol><p>编写docker-compose文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim docker-compose.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=m>1</span> version: <span class=s2>&#34;3.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=m>2</span> 
</span></span><span class=line><span class=cl>  <span class=m>3</span> services:
</span></span><span class=line><span class=cl>  <span class=m>4</span>   tomcat:
</span></span><span class=line><span class=cl>        container_name: tomcat1 <span class=c1>#相当于docker run 的 --name，指定了container_name后在同一个网桥中的容器可以使用 container_name代替ip</span>
</span></span><span class=line><span class=cl>  <span class=m>5</span>     image: tomcat
</span></span><span class=line><span class=cl>  <span class=m>6</span>     ports:
</span></span><span class=line><span class=cl>  <span class=m>7</span>      - 8080:8080
</span></span><span class=line><span class=cl>  		volumes: <span class=c1>#相当于docker run 的 -v</span>
</span></span><span class=line><span class=cl>  		 - /root/webapps:/usr/local/tomcat/webapps
</span></span><span class=line><span class=cl>  		networks: <span class=c1>#相当于docker run的--network</span>
</span></span><span class=line><span class=cl>  		 - hello <span class=c1>#代表当前服务使用那么网桥</span>
</span></span><span class=line><span class=cl>  		command: <span class=s2>&#34;xxxx&#34;</span> <span class=c1>#覆盖容器默认命令</span>
</span></span><span class=line><span class=cl>  		 
</span></span><span class=line><span class=cl>networks： <span class=c1>#定义服务使用的网桥</span>
</span></span><span class=line><span class=cl>  hello： <span class=c1>#创建网桥，默认为bridge，默认名称为项目名_网桥名</span>
</span></span><span class=line><span class=cl>    external: <span class=nb>true</span> <span class=c1>#使用外部网桥，但是网桥必须存在，docker network -d bridge hello</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  :wq
</span></span></code></pre></div><h2 id=portainer>portainer<a hidden class=anchor aria-hidden=true href=#portainer>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#安装</span>
</span></span><span class=line><span class=cl>docker pull portainer/portainer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#创建volume用于保存portainer的数据</span>
</span></span><span class=line><span class=cl>docker volume create portainer_data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#运行,-p 9000:9000用于映射portainer内部web访问页面，-v portainer_data:/data用于保存portainer数据，-v /var/run/docker.sock:/var/run/docker.sock用于映射docker的管理套接字到portainer内部来获取docker信息</span>
</span></span><span class=line><span class=cl>docker run -d -p 9000:9000 -v portainer_data:/data -v /var/run/docker.sock:/var/run/docker.sock --name docker_portainer portainer/portainer
</span></span></code></pre></div><h2 id=namespace>namespace<a hidden class=anchor aria-hidden=true href=#namespace>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#lsns命令可以查看指定类型的namespace下的进程</span>
</span></span><span class=line><span class=cl>lsns -t &lt;namespace_type&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#查看容器的pid号</span>
</span></span><span class=line><span class=cl>docker inpsect xxx <span class=p>|</span>grep -i pid 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#nsenter进入到指定pid号的进程的指定namespace中执行命令</span>
</span></span><span class=line><span class=cl>nsenter -t &lt;pid&gt; --mount --uts --ipc --net --pid -user ip addr
</span></span></code></pre></div><h2 id=使用阿里云代理拉取gcr>使用阿里云代理拉取gcr<a hidden class=anchor aria-hidden=true href=#使用阿里云代理拉取gcr>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/<span class=o>{</span>group<span class=o>}</span>-<span class=o>{</span>project<span class=o>}</span>
</span></span><span class=line><span class=cl>docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/<span class=o>{</span>group<span class=o>}</span>-<span class=o>{</span>project<span class=o>}</span>  gcr.io/<span class=o>{</span>group<span class=o>}</span>/<span class=o>{</span>project<span class=o>}</span>
</span></span><span class=line><span class=cl>docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/<span class=o>{</span>group<span class=o>}</span>-<span class=o>{</span>project<span class=o>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://moyuduo.github.io/posts/%E7%AC%94%E8%AF%95%E9%A2%98/><span class=title>« Prev</span><br><span>面试题</span></a>
<a class=next href=https://moyuduo.github.io/posts/linux/><span class=title>Next »</span><br><span>Linux</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker简介及使用 on twitter" href="https://twitter.com/intent/tweet/?text=Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8&url=https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker简介及使用 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f&title=Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8&summary=Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8&source=https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker简介及使用 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f&title=Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker简介及使用 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker简介及使用 on whatsapp" href="https://api.whatsapp.com/send?text=Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8%20-%20https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker简介及使用 on telegram" href="https://telegram.me/share/url?text=Docker%e7%ae%80%e4%bb%8b%e5%8f%8a%e4%bd%bf%e7%94%a8&url=https%3a%2f%2fmoyuduo.github.io%2fposts%2fdocker%25E7%25AE%2580%25E4%25BB%258B%25E5%258F%258A%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://moyuduo.github.io/>Moyuduo's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>