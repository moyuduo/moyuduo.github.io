<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>elasticsearch相关 | Moyuduo's Blog</title><meta name=keywords content><meta name=description content="elasticsearch相关 安装 保证已有java环境
下载安装包
mkdir -p /opt/elasticsearch cd /opt/elasticsearch #从https://www.elastic.co/cn/downloads/elasticsearch获取es安装包路径 curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-linux-x86_64.tar.gz 解压
tar -zxvf elasticsearch-7.14.1-linux-x86_64.tar.gz 启动
cd elasticsearch-7.14.1/bin/ ./elasticsearch #出现以下错误 java.lang.RuntimeException: can not run elasticsearch as root #第一步，添加es组及该组下的es用户 groupadd es useradd es -g es #出现以下错误 useradd: cannot open /etc/passwd #查看该文件的权限 lsattr /etc/passwd -----a-------e-- /etc/passwd #去除掉该文件的a权限 chattr -a /etc/passwd #再次尝试添加用户 useradd es -g es #出现以下错误，解决思路和上面类似 useradd: cannot open /etc/shadow lsattr /etc/shadow -----a-------e-- /etc/shadow chattr -a /etc/shadow #再次创建用户就成功了 useradd es -g es #第二部，更改elasticsearch文件夹的权限为es组下的es用户 chown -R es:es /opt/elasticsearch #第三步，切换到es用户再启动es su es ."><meta name=author content="Me"><link rel=canonical href=https://moyuduo.github.io/posts/elasticsearch%E7%9B%B8%E5%85%B3/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="elasticsearch相关"><meta property="og:description" content="elasticsearch相关 安装 保证已有java环境
下载安装包
mkdir -p /opt/elasticsearch cd /opt/elasticsearch #从https://www.elastic.co/cn/downloads/elasticsearch获取es安装包路径 curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-linux-x86_64.tar.gz 解压
tar -zxvf elasticsearch-7.14.1-linux-x86_64.tar.gz 启动
cd elasticsearch-7.14.1/bin/ ./elasticsearch #出现以下错误 java.lang.RuntimeException: can not run elasticsearch as root #第一步，添加es组及该组下的es用户 groupadd es useradd es -g es #出现以下错误 useradd: cannot open /etc/passwd #查看该文件的权限 lsattr /etc/passwd -----a-------e-- /etc/passwd #去除掉该文件的a权限 chattr -a /etc/passwd #再次尝试添加用户 useradd es -g es #出现以下错误，解决思路和上面类似 useradd: cannot open /etc/shadow lsattr /etc/shadow -----a-------e-- /etc/shadow chattr -a /etc/shadow #再次创建用户就成功了 useradd es -g es #第二部，更改elasticsearch文件夹的权限为es组下的es用户 chown -R es:es /opt/elasticsearch #第三步，切换到es用户再启动es su es ."><meta property="og:type" content="article"><meta property="og:url" content="https://moyuduo.github.io/posts/elasticsearch%E7%9B%B8%E5%85%B3/"><meta property="og:image" content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-27T16:16:14+08:00"><meta property="article:modified_time" content="2022-11-27T16:16:14+08:00"><meta property="og:site_name" content="Moyuduo's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="elasticsearch相关"><meta name=twitter:description content="elasticsearch相关 安装 保证已有java环境
下载安装包
mkdir -p /opt/elasticsearch cd /opt/elasticsearch #从https://www.elastic.co/cn/downloads/elasticsearch获取es安装包路径 curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-linux-x86_64.tar.gz 解压
tar -zxvf elasticsearch-7.14.1-linux-x86_64.tar.gz 启动
cd elasticsearch-7.14.1/bin/ ./elasticsearch #出现以下错误 java.lang.RuntimeException: can not run elasticsearch as root #第一步，添加es组及该组下的es用户 groupadd es useradd es -g es #出现以下错误 useradd: cannot open /etc/passwd #查看该文件的权限 lsattr /etc/passwd -----a-------e-- /etc/passwd #去除掉该文件的a权限 chattr -a /etc/passwd #再次尝试添加用户 useradd es -g es #出现以下错误，解决思路和上面类似 useradd: cannot open /etc/shadow lsattr /etc/shadow -----a-------e-- /etc/shadow chattr -a /etc/shadow #再次创建用户就成功了 useradd es -g es #第二部，更改elasticsearch文件夹的权限为es组下的es用户 chown -R es:es /opt/elasticsearch #第三步，切换到es用户再启动es su es ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://moyuduo.github.io/posts/"},{"@type":"ListItem","position":2,"name":"elasticsearch相关","item":"https://moyuduo.github.io/posts/elasticsearch%E7%9B%B8%E5%85%B3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"elasticsearch相关","name":"elasticsearch相关","description":"elasticsearch相关 安装 保证已有java环境\n下载安装包\nmkdir -p /opt/elasticsearch cd /opt/elasticsearch #从https://www.elastic.co/cn/downloads/elasticsearch获取es安装包路径 curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-linux-x86_64.tar.gz 解压\ntar -zxvf elasticsearch-7.14.1-linux-x86_64.tar.gz 启动\ncd elasticsearch-7.14.1/bin/ ./elasticsearch #出现以下错误 java.lang.RuntimeException: can not run elasticsearch as root #第一步，添加es组及该组下的es用户 groupadd es useradd es -g es #出现以下错误 useradd: cannot open /etc/passwd #查看该文件的权限 lsattr /etc/passwd -----a-------e-- /etc/passwd #去除掉该文件的a权限 chattr -a /etc/passwd #再次尝试添加用户 useradd es -g es #出现以下错误，解决思路和上面类似 useradd: cannot open /etc/shadow lsattr /etc/shadow -----a-------e-- /etc/shadow chattr -a /etc/shadow #再次创建用户就成功了 useradd es -g es #第二部，更改elasticsearch文件夹的权限为es组下的es用户 chown -R es:es /opt/elasticsearch #第三步，切换到es用户再启动es su es .","keywords":[],"articleBody":"elasticsearch相关 安装 保证已有java环境\n下载安装包\nmkdir -p /opt/elasticsearch cd /opt/elasticsearch #从https://www.elastic.co/cn/downloads/elasticsearch获取es安装包路径 curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-linux-x86_64.tar.gz 解压\ntar -zxvf elasticsearch-7.14.1-linux-x86_64.tar.gz 启动\ncd elasticsearch-7.14.1/bin/ ./elasticsearch #出现以下错误 java.lang.RuntimeException: can not run elasticsearch as root #第一步，添加es组及该组下的es用户 groupadd es useradd es -g es #出现以下错误 useradd: cannot open /etc/passwd #查看该文件的权限 lsattr /etc/passwd -----a-------e-- /etc/passwd #去除掉该文件的a权限 chattr -a /etc/passwd #再次尝试添加用户 useradd es -g es #出现以下错误，解决思路和上面类似 useradd: cannot open /etc/shadow lsattr /etc/shadow -----a-------e-- /etc/shadow chattr -a /etc/shadow #再次创建用户就成功了 useradd es -g es #第二部，更改elasticsearch文件夹的权限为es组下的es用户 chown -R es:es /opt/elasticsearch #第三步，切换到es用户再启动es su es ./elasticsearch 本机测试访问\ncurl localhost:9200 { \"name\" : \"i-u8fxb68q\", \"cluster_name\" : \"elasticsearch\", \"cluster_uuid\" : \"ilI5gIKCQeWmQ0X8r2HXtg\", \"version\" : { \"number\" : \"7.14.1\", \"build_flavor\" : \"default\", \"build_type\" : \"tar\", \"build_hash\" : \"66b55ebfa59c92c15db3f69a335d500018b3331e\", \"build_date\" : \"2021-08-26T09:01:05.390870785Z\", \"build_snapshot\" : false, \"lucene_version\" : \"8.9.0\", \"minimum_wire_compatibility_version\" : \"6.8.0\", \"minimum_index_compatibility_version\" : \"6.0.0-beta1\" }, \"tagline\" : \"You Know, for Search\" } 修改配置文件支持其他机器访问\ncd /opt/elasticsearch/elasticsearch-7.14.1/config vim elasticsearch.yml #把network.host的注释去掉，并修改为接受访问的ip network.host: 0.0.0.0 cd /opt/elasticsearch/elasticsearch-7.14.1/bin #重启启动es #可以使用-d参数指定后台启动 ./elasticsearch #出现以下三个错误 bootstrap check failure [1] of [3]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535] bootstrap check failure [2] of [3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] bootstrap check failure [3] of [3]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured #参考：https://www.cnblogs.com/zhi-leaf/p/8484337.html #解决第一个错误，大概意思是es需要打开的文件多，超过了最大现在，要开放多点可以打开的文件数 #编辑 /etc/security/limits.conf，追加以下内容 soft nofile 65536 hard nofile 65536 su root echo \"* soft nofile 65536\" \u003e\u003e /etc/security/limits.conf echo \"* hard nofile 65536\" \u003e\u003e /etc/security/limits.conf #解决第二个问题 sudo sysctl -w vm.max_map_count=262144 #解决第三个问题 #修改es的config目录下的elasticsearch.yml文件，在cluster.initial_master_nodes: [\"node-1\", \"node-2\"]的下面新增cluster.initial_master_nodes: [\"node-1\"] 添加开机自启动\n#!/bin/bash while true do count=`ps -ef|grep elasticsearch|grep -v grep|grep -v auto_start|wc -l` if [ $count -eq 0 ]; then su - es -s /bin/bash /opt/elasticsearch/elasticsearch-7.14.1/bin/elasticsearch \u0026 echo \"restart elasticsearch at $(date)\" \u003e\u003e /opt/elasticsearch/record fi sleep 1 done 图形化管理界面kibana 在https://www.elastic.co/cn/downloads/kibana上选择与es版本对应的kibana\n下载kibana到linux\nmkdir -p /opt/kibana cd /opt/kibana curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.14.1-linux-x86_64.tar.gz 解压\ntar -zxvf kibana-7.14.1-linux-x86_64.tar.gz 修改配置文件\ncd /opt/kibana/kibana-7.14.1-linux-x86_64/config vim kibana.yml #kibana管理界面web的访问端口 server.port: 5601 #kibana接受访问的ip，配置0.0.0.0以供外部访问 server.host: 0.0.0.0 #es集群的地址，如果es部署的环境不是和kibana同一台机器需要修改 elasticsearch.hosts: [\"http://localhost:9200\"] #kibana管理界面语言，支持en(默认)、zh-CN i18n.locale: \"zh-CN\" 修改防火墙开放端口\nfirewall-cmd --add-port=5601/tcp --permanent firewall-cmd --reload 启动\n#在启动kibana之前必须保证es已经启动 cd ../bin/ ./kibana #提示 Kibana should not be run as root. Use --allow-root to continue. ./kibana --allow-root #出现以下即成功 log [10:37:32.033] [info][status] Kibana is now available 操作 查看当前节点下的所有index\ncurl 139.198.11.13:9200/_cat/indices?v 查看所有index包含的mapping\ncurl 139.198.11.13:9200/_mapping?pretty=true 创建和删除index\ncurl -X PUT 139.198.11.13:9200/weather #acknowledged为true表示成功创建index {\"acknowledged\":true,\"shards_acknowledged\":true,\"index\":\"weather\"} curl -X DELETE 139.198.11.13:9200/weather #acknowledged为true表示删除index成功 {\"acknowledged\":true} 创建index并指定mapping\n7.x以前\nPUT twitter { \"mappings\": { \"user\": { \"properties\": { \"name\": { \"type\": \"text\" }, \"user_name\": { \"type\": \"keyword\" }, \"email\": { \"type\": \"keyword\" } } }, \"tweet\": { \"properties\": { \"content\": { \"type\": \"text\" }, \"user_name\": { \"type\": \"keyword\" }, \"tweeted_at\": { \"type\": \"date\" } } } } } 在7.x以前一个index可以指定多个mapping，但是7.x以后移除了对一个index多个mapping的执行，创建多个index会报错\nFailed to parse mapping [_doc]: Root mapping definition has unsupported parameters\n现在默认的mapping为_doc\n移除index多个mapping的主要原因是：以前使用index类比database，mapping类比table，doc类比row，也就意味着index可以创建多个mapping，但是正数据库中多个表的同名字段如name其实是没有任何关联的，但是在es中，一个index下的所有mapping的同名字段其实都对应一个field，也就意味着多个mapping的同名字段的类型必须相同，在进行删除一个type的filed时可能失败(其他mapping还在使用),并且统一索引中没有公共字段的或很少公共字段的实体会导致数据稀疏，影响lucene压缩文档的能力\n#每个index只能有一个mapping $ curl -X PUT 'localhost:9200/accounts222' -d ' { \"mappings\": { \"properties\": { \"user\": { \"type\": \"text\" }, \"title\": { \"type\": \"text\" }, \"desc\": { \"type\": \"text\" } } } }' #单独创建type,但是如果index user不存在会报错 http://139.198.11.13:9200/user/_mapping body:{ \"properties\":{ \"name\":{ \"type\": \"text\", \"index\": true }, \"age\":{ \"type\": \"long\", \"index\": true }, \"gender\": { \"type\": \"text\", \"index\": true } } } resp:{ \"acknowledged\": true } #如果以上请求发送多次那么mapping的properties会叠加 查看指定index的mapping\nurl:{{localhost}}:9200/accounts222/_mapping resp:{ \"accounts222\": { \"mappings\": { \"properties\": { \"desc\": { \"type\": \"text\" }, \"title\": { \"type\": \"text\" }, \"user\": { \"type\": \"text\" } } } } } 创建doc不指定id，POST非幂等性\n{{localhost}}:9200/accounts222/_doc body:{ \"user\": \"张三\", \"title\": \"工程师\", \"desc\": \"数据库管理\" } #随机id resp:{ \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"E83dxHsBx8UYn7wDPx-g\", \"_version\": 1, \"result\": \"created\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 0, \"_primary_term\": 1 } 创建doc并指定id，PUT幂等性\n{{localhost}}:9200/accounts222/_doc/1 body: { \"user\": \"李四\", \"title\": \"工程师\", \"desc\": \"开发\" } resp: { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_version\": 1, \"result\": \"created\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 1, \"_primary_term\": 1 } 查看指定index所有doc\nurl：{{localhost}}:9200/accounts222/_search body(也可以不指定)：{ \"query\":{ \"match_all\":{} } } resp:{ \"took\": 1, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 2, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"E83dxHsBx8UYn7wDPx-g\", \"_score\": 1, \"_source\": { \"user\": \"张三\", \"title\": \"工程师\", \"desc\": \"数据库管理\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_score\": 1, \"_source\": { \"user\": \"李四\", \"title\": \"工程师\", \"desc\": \"开发\" } } ] } } 按照id查询index下指定文档\nurl:{{localhost}}:9200/accounts222/_doc/1 resp: 未找到情况 { \"_index\": \"user\", \"_type\": \"_doc\", \"_id\": \"1\", \"found\": false } 查找到 { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_version\": 2, \"_seq_no\": 2, \"_primary_term\": 1, \"found\": true, \"_source\": { \"user\": \"李四\", \"title\": \"工程师\", \"desc\": \"开发\" } } 修改文档\nurl:{{localhost}}:9200/accounts222/_doc/1 #如果指定的filed比mapping的字段少，那么其余字段都会被置空 body:{ \"user\": \"lisi\", \"title\": \"经理\", \"desc\": \"男\" } resp:{ \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_version\": 3, \"result\": \"updated\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 3, \"_primary_term\": 1 } 修改文档单个字段\nurl:{{localhost}}:9200/accounts222/_update/1 body:{ \"doc\":{ \"user\":\"李四\" } } resp:{ \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_version\": 4, \"result\": \"updated\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 4, \"_primary_term\": 1 } 删除文档\nurl:{{localhost}}:9200/accounts222/_doc/E83dxHsBx8UYn7wDPx-g resp:{ \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"E83dxHsBx8UYn7wDPx-g\", \"_version\": 2, \"result\": \"deleted\", \"_shards\": { \"total\": 2, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 6, \"_primary_term\": 1 } 但条件查询,默认一次返回10条记录，可以通过size指定,可以通过from指定偏移量\nurl:{{localhost}}:9200/accounts222/_doc/_search或{{localhost}}:9200/accounts222/_search body:{ \"query\":{ \"match\":{ \"user\": \"张\" } }, \"size\": 5, \"from\": 5 } resp:{ \"took\": 0, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 1, \"relation\": \"eq\" }, \"max_score\": 1.2576691, \"hits\": [ { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"G80hyXsBx8UYn7wDUh9z\", \"_score\": 1.2576691, \"_source\": { \"user\": \"张三\", \"title\": \"工程师\", \"desc\": \"数据库管理\" } } ] } } #如果查询参数用多个且用空格分开，那么es认为它们是or的关系 body:{ \"query\":{ \"match\":{ \"user\": \"张 五\" } }, \"size\": 5, \"from\": 5 } #如以上查询条件可匹配user为张三、王五的记录 #如果多个关键词是and的关系，那么要使用bool查询器 url:{{localhost}}:9200/accounts222/_search body:{ \"query\": { \"bool\":{ \"must\": [ {\"match\":{\"user\":\"张\"}}, {\"match\":{\"desc\": \"管理\"}} ] } } } #以上查询条件可匹配user中包含张、desc中包含管理的记录 #精确匹配field url:{{localhost}}:9200/accounts222/_search body:{ \"query\":{ \"terms\": { \"user\": [\"tom\", \"jack\"] } } } resp: { \"took\": 1, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 2, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_score\": 1, \"_source\": { \"user\": \"jack\", \"title\": \"工程师\", \"desc\": \"开发\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"2\", \"_score\": 1, \"_source\": { \"user\": \"tom\", \"title\": \"工程师\", \"desc\": \"开发\" } } ] } } #精确匹配只适用于英文，中文只能用模糊匹配 { \"query\":{ \"match\":{\"user\":\"张三 王五\"} } } 查询文档指定字段\nurl:{{localhost}}:9200/accounts222/_doc/_search body:{ \"_source\":[\"user\"] } resp:{ \"took\": 1, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 6, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"G80hyXsBx8UYn7wDUh9z\", \"_score\": 1, \"_source\": { \"user\": \"张三\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"HM0hyXsBx8UYn7wDlB8-\", \"_score\": 1, \"_source\": { \"user\": \"王五\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_score\": 1, \"_source\": { \"user\": \"jack\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"2\", \"_score\": 1, \"_source\": { \"user\": \"tom\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"3\", \"_score\": 1, \"_source\": { \"user\": \"mary\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"myd\", \"_score\": 1, \"_source\": { \"user\": \"myd\" } } ] } } 按_id查询文档\nurl:{{localhost}}:9200/accounts222/_doc/1 resp:{ \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_version\": 10, \"_seq_no\": 13, \"_primary_term\": 1, \"found\": true, \"_source\": { \"user\": \"jack\", \"title\": \"工程师\", \"desc\": \"开发\" } } 高亮显示搜索词\nurl:{{localhost}}:9200/accounts222/_doc/_search body:{ \"query\":{ \"match\":{ \"user\": \"张\" } }, \"highlight\":{ \"fields\":{ \"user\":{} } } } resp:{ \"took\": 74, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 1, \"relation\": \"eq\" }, \"max_score\": 1.5108216, \"hits\": [ { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"G80hyXsBx8UYn7wDUh9z\", \"_score\": 1.5108216, \"_source\": { \"user\": \"张三\", \"title\": \"工程师\", \"desc\": \"数据库管理\" }, \"highlight\": { \"user\": [ \"张三\" ] } } ] } } 短语查询(phrase search)\n#针对英文有效，中文情况下无效 url:{{localhost}}:9200/accounts222/_doc/_search body:{ \"query\":{ \"match_phrase\":{ \"user\":\"tom\" } } } resp:{ \"took\": 0, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 1, \"relation\": \"eq\" }, \"max_score\": 1.4417952, \"hits\": [ { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"2\", \"_score\": 1.4417952, \"_source\": { \"user\": \"tom\", \"title\": \"工程师\", \"desc\": \"开发\" } } ] } } 条件删除文档\nurl:{{localhost}}:9200/accounts222/_doc/_delete_by_query\tpost body:{ \"query\":{ \"match\":{ \"user\":\"myd\" } } } resp:{ \"took\": 11, \"timed_out\": false, \"total\": 1, \"deleted\": 1, \"batches\": 1, \"version_conflicts\": 0, \"noops\": 0, \"retries\": { \"bulk\": 0, \"search\": 0 }, \"throttled_millis\": 0, \"requests_per_second\": -1, \"throttled_until_millis\": 0, \"failures\": [] } 路径通配符,通配符支持*和？*匹配任意多字符包括空字符，?只能匹配一个字符\nurl:{{localhost}}:9200/account*/_doc/_search\tget resp:{ \"took\": 1, \"timed_out\": false, \"_shards\": { \"total\": 2, \"successful\": 2, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 6, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"account\", \"_type\": \"_doc\", \"_id\": \"Hc3YznsBx8UYn7wDPB9x\", \"_score\": 1, \"_source\": { \"name\": \"myd\", \"age\": 20 } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"G80hyXsBx8UYn7wDUh9z\", \"_score\": 1, \"_source\": { \"user\": \"张三\", \"title\": \"工程师\", \"desc\": \"数据库管理\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"HM0hyXsBx8UYn7wDlB8-\", \"_score\": 1, \"_source\": { \"user\": \"王五\", \"title\": \"经理\", \"desc\": \"manager\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"1\", \"_score\": 1, \"_source\": { \"user\": \"jack\", \"title\": \"工程师\", \"desc\": \"开发\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"2\", \"_score\": 1, \"_source\": { \"user\": \"tom\", \"title\": \"工程师\", \"desc\": \"开发\" } }, { \"_index\": \"accounts222\", \"_type\": \"_doc\", \"_id\": \"3\", \"_score\": 1, \"_source\": { \"user\": \"mary\", \"title\": \"工程师\", \"desc\": \"开发\" } } ] } } 查询条件通配符\nurl:{{localhost}}:9200/account/_doc/_search\tget body:{ \"query\":{ \"wildcard\":{ \"name\": \"m*\" } } } resp:{ \"took\": 13, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 2, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"account\", \"_type\": \"_doc\", \"_id\": \"Hc3YznsBx8UYn7wDPB9x\", \"_score\": 1, \"_source\": { \"name\": \"myd\", \"age\": 20 } }, { \"_index\": \"account\", \"_type\": \"_doc\", \"_id\": \"Hs3bznsBx8UYn7wD9x93\", \"_score\": 1, \"_source\": { \"name\": \"mary\", \"age\": 30 } } ] } } 聚合查询\n#查询最大值 url:{{localhost}}:9200/account/_doc/_search\tget #\"size\": 0去除hit.hit中的数据 body:{ \"aggs\":{ \"max_age\":{ \"max\":{ \"field\":\"age\" } } }, \"size\": 0 } resp:{ \"took\": 1, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 5, \"relation\": \"eq\" }, \"max_score\": null, \"hits\": [] }, \"aggregations\": { \"max_age\": { \"value\": 30 } } } go api操作 package main import ( \"context\" \"encoding/json\" \"fmt\" \"reflect\" \"time\" es \"github.com/olivere/elastic/v7\" ) type Tweet struct { User string `json:\"user\"` Message string `json:\"message\"` Retweets int `json:\"retweets\"` Image string `json:\"image,omitempty\"` Created time.Time `json:\"created,omitempty\"` Tags []string `json:\"tags,omitempty\"` Location string `json:\"location,omitempty\"` Suggest *es.SuggestField `json:\"suggest_field,omitempty\"` } const mapping = ` { \"settings\":{ \"number_of_shards\": 1, \"number_of_replicas\": 0 }, \"mappings\":{ \"properties\":{ \"user\":{ \"type\":\"keyword\" }, \"message\":{ \"type\":\"text\", \"store\": true, \"fielddata\": true }, \"image\":{ \"type\":\"keyword\" }, \"created\":{ \"type\":\"date\" }, \"tags\":{ \"type\":\"keyword\" }, \"location\":{ \"type\":\"geo_point\" }, \"suggest_field\":{ \"type\":\"completion\" } } } }` func main() { host := \"http://139.198.11.13:9200\" client, err := es.NewClient( es.SetURL(host), es.SetSniff(false), es.SetHealthcheck(false), ) // client, err := es.NewClientFromConfig(\u0026config.Config{ // URL: \"http://139.198.11.13:9200\", // }) if err != nil { panic(err) } fmt.Println(\"connect to es success.\") version, err := client.ElasticsearchVersion(host) if err != nil { panic(err) } fmt.Println(\"version:\", version) ctx := context.Background() res, code, err := client.Ping(host).Do(ctx) if err != nil { panic(err) } fmt.Printf(\"version:%s \\n code:%d \\n\", res.Version.Number, code) exists, err := client.IndexExists(\"twitter\").Do(ctx) if err != nil { panic(err) } fmt.Println(\"twitter exists:\", exists) if !exists { res, err := client.CreateIndex(\"twitter\").BodyString(mapping).Do(ctx) if err != nil { panic(err) } if !res.Acknowledged { fmt.Println(\"create index twitter faild\") } else { fmt.Println(\"create index twitter success\") } } //add a doc to twitter use json tweet1 := Tweet{User: \"olivere\", Message: \"Take Five\", Retweets: 0} put1, err := client.Index().Index(\"twitter\").BodyJson(tweet1).Id(\"1\").Do(ctx) if err != nil { panic(err) } fmt.Printf(\"add tweet %s to index %s type is %s \\n\", put1.Id, put1.Index, put1.Type) //add a doc to twitter use string tweet2 := `{\"user\" : \"olivere\", \"message\" : \"aaa\"}` put2, err := client.Index().Index(\"twitter\").Type(\"_doc\").Id(\"2\").BodyString(tweet2).Do(ctx) if err != nil { panic(err) } fmt.Printf(\"add tweet %s to index %s type is %s \\n\", put2.Id, put2.Index, put2.Type) //get doc tweet specified id get1, err := client.Get().Index(\"twitter\").Type(\"_doc\").Id(\"1\").Do(ctx) if err != nil { panic(err) } if get1.Found { fmt.Printf(\"doc %s in index %s founded, version is %d, doc: %s \\n\", get1.Id, get1.Index, get1.Version, get1.Source) } else { fmt.Println(\"doc 1 in index twitter not found\") } termQ := es.NewTermQuery(\"user\", \"olivere\") search1, err := client.Search().Index(\"twitter\").Query(termQ).From(1).Size(1).Pretty(true).Do(ctx) if err != nil { panic(err) } fmt.Printf(\"term query took %d ms \\n\", search1.TookInMillis) var ttyp Tweet for _, item := range search1.Each(reflect.TypeOf(ttyp)) { if t, ok := item.(Tweet); ok { fmt.Printf(\"Tweet by %s: %s \\n\", t.User, t.Message) fmt.Printf(\"---Tweet: %#v \\n\", t) } } fmt.Printf(\"found a total of %d tweets \\n\", search1.TotalHits()) if search1.Hits.TotalHits.Value \u003e 0 { fmt.Printf(\"found a total of %d tweets \\n\", search1.Hits.TotalHits.Value) for _, hit := range search1.Hits.Hits { var t Tweet err := json.Unmarshal(hit.Source, \u0026t) if err != nil { panic(err) } fmt.Printf(\"tweet by %s : %s \\n\", t.User, t.Message) fmt.Printf(\"===Tweet: %#v \\n\", t) } } else { fmt.Println(\"found no tweets\") } //update doc update1, err := client.Update().Index(\"twitter\").Id(\"1\").Script(es.NewScriptInline(\"ctx._source.retweets += params.num\").Lang(\"painless\").Param(\"num\", 1)). Upsert(map[string]interface{}{\"retweets\": 5}).Do(ctx) if err != nil { panic(err) } fmt.Printf(\"new version of tweet %q is now %d\\n\", update1.Id, update1.Version) //del doc del1, err := client.Delete().Index(\"twitter\").Id(\"1\").Do(ctx) if err != nil { panic(err) } fmt.Printf(\"delete status: %d \\n\", del1.Status) } es中的shard(primary shard)和replica(replica shard) es是集群工作的，如果只有一台机器的话那么整个集群就只有这一台，es集群按照index来划分数据，在创建index的时候如果什么参数都不指定，那么默认创建一个shard(primary shard)和1个replica(replica shard),但是一个shard对应的replica不能在同一台机器上，如果是一台机器的集群，那么replica有没有机器去分配，那么该index的状态就会是yellow,一个index的状态由green、yellow、red三种，green状态是index的所有shard和replica都正常，yellow状态是index的所有shard正常，部分或全部replica不正常，red状态则是有shard不正常\n在创建index的时候可以指定shard、replicad 的个数，使用\n{ \"settings\":{ \"number_of_shards\":2, \"number_of_replicas\":1 } } 这里要注意的是number_of_replicas的数量不是总的replica数量，replica是针对shard而言的，也就是这里的number_of_replicas是指每个shard有多少个replica\n如果在创建index时指定了多个shard而es集群只有单台机器，那么有所的shard会存在同一台机器上，当有新的机器加入es集群，这些shard会移动到新加入的es节点上\n一个index的多个replica不能在es集群的同一个节点上\nes中创建doc时存储路由 在es中一个index有多个primary，每个doc都是存储到一个指定的primary，那么在创建doc的时候是如何选择该doc是要保存在那个primary中的，在es中选择doc存储的primary是通过routing来决定的，默认情况下routing为_id，具体计算存那个primary的规则为：hash(routing) % number_primarys 来得到该文档存放的primary下标，在创建doc的时候也可以指定routing来手动指定要存放的位置\nurl:{{localhost}}:9200/testroute1/_doc/2?routing=b\tPUT body:{ \"name\":\"b\" } resp:{ \"_index\": \"testroute1\", \"_type\": \"_doc\", \"_id\": \"2\", \"_version\": 1, \"result\": \"created\", \"_shards\": { \"total\": 1, \"successful\": 1, \"failed\": 0 }, \"_seq_no\": 0, \"_primary_term\": 1 } 查询doc并指定routing\nurl:{{localhost}}:9200/testroute1/_doc/_search?routing=a\tGET resp:{ \"took\": 422, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 1, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"testroute1\", \"_type\": \"_doc\", \"_id\": \"1\", \"_score\": 1, \"_routing\": \"a\", \"_source\": { \"name\": \"a\" } } ] } } url:{{localhost}}:9200/testroute1/_doc/2?routing=a GET resp:{ \"_index\": \"testroute1\", \"_type\": \"_doc\", \"_id\": \"2\", \"found\": false } 创建index的时候指定doc增删改查都必须带上routing\nurl:{{localhost}}:9200/testroute2\tPUT body:{ \"settings\":{ \"number_of_shards\":2, \"number_of_replicas\":2 }, \"mappings\":{ \"_routing\":{ \"required\":true } } } resp:{ \"acknowledged\": true, \"shards_acknowledged\": true, \"index\": \"testroute2\" } ","wordCount":"2228","inLanguage":"en","datePublished":"2022-11-27T16:16:14+08:00","dateModified":"2022-11-27T16:16:14+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://moyuduo.github.io/posts/elasticsearch%E7%9B%B8%E5%85%B3/"},"publisher":{"@type":"Organization","name":"Moyuduo's Blog","logo":{"@type":"ImageObject","url":"https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://moyuduo.github.io/ accesskey=h title="Moyuduo's Blog (Alt + H)"><img src=https://moyuduo.github.io/apple-touch-icon.png alt aria-label=logo height=35>Moyuduo's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://moyuduo.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://moyuduo.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://moyuduo.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://moyuduo.github.io/posts/>Posts</a></div><h1 class=post-title>elasticsearch相关</h1><div class=post-meta><span title='2022-11-27 16:16:14 +0800 +0800'>November 27, 2022</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2228 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/elasticsearch%e7%9b%b8%e5%85%b3.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h1 id=elasticsearch相关>elasticsearch相关<a hidden class=anchor aria-hidden=true href=#elasticsearch相关>#</a></h1><h2 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h2><ol><li><p>保证已有java环境</p></li><li><p>下载安装包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p /opt/elasticsearch
</span></span><span class=line><span class=cl><span class=nb>cd</span> /opt/elasticsearch
</span></span><span class=line><span class=cl><span class=c1>#从https://www.elastic.co/cn/downloads/elasticsearch获取es安装包路径</span>
</span></span><span class=line><span class=cl>curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.14.1-linux-x86_64.tar.gz
</span></span></code></pre></div></li><li><p>解压</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tar -zxvf elasticsearch-7.14.1-linux-x86_64.tar.gz
</span></span></code></pre></div></li><li><p>启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> elasticsearch-7.14.1/bin/
</span></span><span class=line><span class=cl>./elasticsearch
</span></span><span class=line><span class=cl><span class=c1>#出现以下错误</span>
</span></span><span class=line><span class=cl>java.lang.RuntimeException: can not run elasticsearch as root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#第一步，添加es组及该组下的es用户</span>
</span></span><span class=line><span class=cl>groupadd es
</span></span><span class=line><span class=cl>useradd es -g es
</span></span><span class=line><span class=cl><span class=c1>#出现以下错误</span>
</span></span><span class=line><span class=cl>useradd: cannot open /etc/passwd
</span></span><span class=line><span class=cl><span class=c1>#查看该文件的权限</span>
</span></span><span class=line><span class=cl>lsattr /etc/passwd
</span></span><span class=line><span class=cl>-----a-------e-- /etc/passwd
</span></span><span class=line><span class=cl><span class=c1>#去除掉该文件的a权限</span>
</span></span><span class=line><span class=cl>chattr -a /etc/passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#再次尝试添加用户</span>
</span></span><span class=line><span class=cl>useradd es -g es
</span></span><span class=line><span class=cl><span class=c1>#出现以下错误，解决思路和上面类似</span>
</span></span><span class=line><span class=cl>useradd: cannot open /etc/shadow
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>lsattr /etc/shadow
</span></span><span class=line><span class=cl>-----a-------e-- /etc/shadow
</span></span><span class=line><span class=cl>chattr -a /etc/shadow
</span></span><span class=line><span class=cl><span class=c1>#再次创建用户就成功了</span>
</span></span><span class=line><span class=cl>useradd es -g es
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#第二部，更改elasticsearch文件夹的权限为es组下的es用户</span>
</span></span><span class=line><span class=cl>chown -R es:es /opt/elasticsearch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#第三步，切换到es用户再启动es</span>
</span></span><span class=line><span class=cl>su es
</span></span><span class=line><span class=cl>./elasticsearch
</span></span></code></pre></div></li><li><p><strong>本机</strong>测试访问</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl localhost:9200
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;name&#34;</span> : <span class=s2>&#34;i-u8fxb68q&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;cluster_name&#34;</span> : <span class=s2>&#34;elasticsearch&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;cluster_uuid&#34;</span> : <span class=s2>&#34;ilI5gIKCQeWmQ0X8r2HXtg&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;version&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;number&#34;</span> : <span class=s2>&#34;7.14.1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_flavor&#34;</span> : <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_type&#34;</span> : <span class=s2>&#34;tar&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_hash&#34;</span> : <span class=s2>&#34;66b55ebfa59c92c15db3f69a335d500018b3331e&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_date&#34;</span> : <span class=s2>&#34;2021-08-26T09:01:05.390870785Z&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_snapshot&#34;</span> : false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;lucene_version&#34;</span> : <span class=s2>&#34;8.9.0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;minimum_wire_compatibility_version&#34;</span> : <span class=s2>&#34;6.8.0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;minimum_index_compatibility_version&#34;</span> : <span class=s2>&#34;6.0.0-beta1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;tagline&#34;</span> : <span class=s2>&#34;You Know, for Search&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>修改配置文件支持其他机器访问</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /opt/elasticsearch/elasticsearch-7.14.1/config
</span></span><span class=line><span class=cl>vim elasticsearch.yml
</span></span><span class=line><span class=cl><span class=c1>#把network.host的注释去掉，并修改为接受访问的ip</span>
</span></span><span class=line><span class=cl>network.host: 0.0.0.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /opt/elasticsearch/elasticsearch-7.14.1/bin
</span></span><span class=line><span class=cl><span class=c1>#重启启动es</span>
</span></span><span class=line><span class=cl><span class=c1>#可以使用-d参数指定后台启动</span>
</span></span><span class=line><span class=cl>./elasticsearch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#出现以下三个错误</span>
</span></span><span class=line><span class=cl>bootstrap check failure <span class=o>[</span>1<span class=o>]</span> of <span class=o>[</span>3<span class=o>]</span>: max file descriptors <span class=o>[</span>4096<span class=o>]</span> <span class=k>for</span> elasticsearch process is too low, increase to at least <span class=o>[</span>65535<span class=o>]</span>
</span></span><span class=line><span class=cl>bootstrap check failure <span class=o>[</span>2<span class=o>]</span> of <span class=o>[</span>3<span class=o>]</span>: max virtual memory areas vm.max_map_count <span class=o>[</span>65530<span class=o>]</span> is too low, increase to at least <span class=o>[</span>262144<span class=o>]</span>
</span></span><span class=line><span class=cl>bootstrap check failure <span class=o>[</span>3<span class=o>]</span> of <span class=o>[</span>3<span class=o>]</span>: the default discovery settings are unsuitable <span class=k>for</span> production use<span class=p>;</span> at least one of <span class=o>[</span>discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes<span class=o>]</span> must be configured
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#参考：https://www.cnblogs.com/zhi-leaf/p/8484337.html</span>
</span></span><span class=line><span class=cl><span class=c1>#解决第一个错误，大概意思是es需要打开的文件多，超过了最大现在，要开放多点可以打开的文件数</span>
</span></span><span class=line><span class=cl><span class=c1>#编辑 /etc/security/limits.conf，追加以下内容</span>
</span></span><span class=line><span class=cl>soft nofile <span class=m>65536</span>
</span></span><span class=line><span class=cl>hard nofile <span class=m>65536</span>
</span></span><span class=line><span class=cl>su root
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;*  soft nofile 65536&#34;</span> &gt;&gt;  /etc/security/limits.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;*  hard nofile 65536&#34;</span> &gt;&gt;  /etc/security/limits.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#解决第二个问题</span>
</span></span><span class=line><span class=cl>sudo sysctl -w vm.max_map_count<span class=o>=</span><span class=m>262144</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#解决第三个问题</span>
</span></span><span class=line><span class=cl><span class=c1>#修改es的config目录下的elasticsearch.yml文件，在cluster.initial_master_nodes: [&#34;node-1&#34;, &#34;node-2&#34;]的下面新增cluster.initial_master_nodes: [&#34;node-1&#34;] </span>
</span></span></code></pre></div></li><li><p>添加开机自启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>while</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=nv>count</span><span class=o>=</span><span class=sb>`</span>ps -ef<span class=p>|</span>grep elasticsearch<span class=p>|</span>grep -v grep<span class=p>|</span>grep -v auto_start<span class=p>|</span>wc -l<span class=sb>`</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>[</span> <span class=nv>$count</span> -eq <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>                su - es -s /bin/bash /opt/elasticsearch/elasticsearch-7.14.1/bin/elasticsearch <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>                <span class=nb>echo</span> <span class=s2>&#34;restart elasticsearch at </span><span class=k>$(</span>date<span class=k>)</span><span class=s2>&#34;</span> &gt;&gt; /opt/elasticsearch/record
</span></span><span class=line><span class=cl>        <span class=k>fi</span>
</span></span><span class=line><span class=cl>        sleep <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div></li></ol><h2 id=图形化管理界面kibana>图形化管理界面kibana<a hidden class=anchor aria-hidden=true href=#图形化管理界面kibana>#</a></h2><ol><li><p>在https://www.elastic.co/cn/downloads/kibana上选择与es版本对应的kibana</p></li><li><p>下载kibana到linux</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p /opt/kibana
</span></span><span class=line><span class=cl><span class=nb>cd</span> /opt/kibana
</span></span><span class=line><span class=cl>curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.14.1-linux-x86_64.tar.gz
</span></span></code></pre></div></li><li><p>解压</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tar -zxvf kibana-7.14.1-linux-x86_64.tar.gz
</span></span></code></pre></div></li><li><p>修改配置文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /opt/kibana/kibana-7.14.1-linux-x86_64/config
</span></span><span class=line><span class=cl>vim kibana.yml
</span></span><span class=line><span class=cl><span class=c1>#kibana管理界面web的访问端口</span>
</span></span><span class=line><span class=cl>server.port: <span class=m>5601</span>
</span></span><span class=line><span class=cl><span class=c1>#kibana接受访问的ip，配置0.0.0.0以供外部访问</span>
</span></span><span class=line><span class=cl>server.host: 0.0.0.0
</span></span><span class=line><span class=cl><span class=c1>#es集群的地址，如果es部署的环境不是和kibana同一台机器需要修改</span>
</span></span><span class=line><span class=cl>elasticsearch.hosts: <span class=o>[</span><span class=s2>&#34;http://localhost:9200&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1>#kibana管理界面语言，支持en(默认)、zh-CN</span>
</span></span><span class=line><span class=cl>i18n.locale: <span class=s2>&#34;zh-CN&#34;</span>
</span></span></code></pre></div></li><li><p>修改防火墙开放端口</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>firewall-cmd --add-port<span class=o>=</span>5601/tcp --permanent
</span></span><span class=line><span class=cl>firewall-cmd --reload
</span></span></code></pre></div></li><li><p>启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#在启动kibana之前必须保证es已经启动</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../bin/
</span></span><span class=line><span class=cl>./kibana
</span></span><span class=line><span class=cl><span class=c1>#提示</span>
</span></span><span class=line><span class=cl>Kibana should not be run as root.  Use --allow-root to <span class=k>continue</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./kibana --allow-root
</span></span><span class=line><span class=cl><span class=c1>#出现以下即成功</span>
</span></span><span class=line><span class=cl>log   <span class=o>[</span>10:37:32.033<span class=o>]</span> <span class=o>[</span>info<span class=o>][</span>status<span class=o>]</span> Kibana is now available
</span></span></code></pre></div></li></ol><h2 id=操作>操作<a hidden class=anchor aria-hidden=true href=#操作>#</a></h2><ol><li><p>查看当前节点下的所有index</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl 139.198.11.13:9200/_cat/indices?v
</span></span></code></pre></div></li><li><p>查看所有index包含的mapping</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl 139.198.11.13:9200/_mapping?pretty<span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></div></li><li><p>创建和删除index</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -X PUT 139.198.11.13:9200/weather
</span></span><span class=line><span class=cl><span class=c1>#acknowledged为true表示成功创建index</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;acknowledged&#34;</span>:true,<span class=s2>&#34;shards_acknowledged&#34;</span>:true,<span class=s2>&#34;index&#34;</span>:<span class=s2>&#34;weather&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -X DELETE 139.198.11.13:9200/weather
</span></span><span class=line><span class=cl><span class=c1>#acknowledged为true表示删除index成功</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;acknowledged&#34;</span>:true<span class=o>}</span>
</span></span></code></pre></div></li><li><p>创建index并指定mapping</p><p>7.x以前</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>PUT twitter
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;mappings&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;user&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;properties&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;name&#34;</span>: <span class=o>{</span> <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user_name&#34;</span>: <span class=o>{</span> <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;keyword&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;email&#34;</span>: <span class=o>{</span> <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;keyword&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;tweet&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;properties&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;content&#34;</span>: <span class=o>{</span> <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user_name&#34;</span>: <span class=o>{</span> <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;keyword&#34;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tweeted_at&#34;</span>: <span class=o>{</span> <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;date&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在7.x以前一个index可以指定多个mapping，但是7.x以后移除了对一个index多个mapping的执行，创建多个index会报错</p><p>Failed to parse mapping [_doc]: Root mapping definition has unsupported parameters</p><p>现在默认的mapping为_doc</p><p>移除index多个mapping的主要原因是：以前使用index类比database，mapping类比table，doc类比row，也就意味着index可以创建多个mapping，但是正数据库中多个表的同名字段如name其实是没有任何关联的，但是在es中，一个index下的所有mapping的同名字段其实都对应一个field，也就意味着多个mapping的同名字段的类型必须相同，在进行删除一个type的filed时可能失败(其他mapping还在使用),并且统一索引中没有公共字段的或很少公共字段的实体会导致数据稀疏，影响lucene压缩文档的能力</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#每个index只能有一个mapping</span>
</span></span><span class=line><span class=cl>$ curl -X PUT <span class=s1>&#39;localhost:9200/accounts222&#39;</span> -d <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>{
</span></span></span><span class=line><span class=cl><span class=s1>  &#34;mappings&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>      &#34;properties&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>        &#34;user&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>          &#34;type&#34;: &#34;text&#34;
</span></span></span><span class=line><span class=cl><span class=s1>        },
</span></span></span><span class=line><span class=cl><span class=s1>        &#34;title&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>          &#34;type&#34;: &#34;text&#34;
</span></span></span><span class=line><span class=cl><span class=s1>        },
</span></span></span><span class=line><span class=cl><span class=s1>        &#34;desc&#34;: {
</span></span></span><span class=line><span class=cl><span class=s1>          &#34;type&#34;: &#34;text&#34;
</span></span></span><span class=line><span class=cl><span class=s1>        }
</span></span></span><span class=line><span class=cl><span class=s1>      }
</span></span></span><span class=line><span class=cl><span class=s1>  }
</span></span></span><span class=line><span class=cl><span class=s1>}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#单独创建type,但是如果index user不存在会报错</span>
</span></span><span class=line><span class=cl>http://139.198.11.13:9200/user/_mapping
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;properties&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;name&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span>,
</span></span><span class=line><span class=cl>			<span class=s2>&#34;index&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>,
</span></span><span class=line><span class=cl>		<span class=s2>&#34;age&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;long&#34;</span>,
</span></span><span class=line><span class=cl>			<span class=s2>&#34;index&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>,
</span></span><span class=line><span class=cl>		<span class=s2>&#34;gender&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span>,
</span></span><span class=line><span class=cl>			<span class=s2>&#34;index&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;acknowledged&#34;</span>: <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#如果以上请求发送多次那么mapping的properties会叠加</span>
</span></span></code></pre></div></li><li><p>查看指定index的mapping</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_mapping
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;accounts222&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;mappings&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;properties&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;desc&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;title&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;user&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;type&#34;</span>: <span class=s2>&#34;text&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>创建doc不指定id，POST非幂等性</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张三&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;数据库管理&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#随机id</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;E83dxHsBx8UYn7wDPx-g&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=s2>&#34;created&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>创建doc并指定id，PUT幂等性</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/1
</span></span><span class=line><span class=cl>body:
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;李四&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=s2>&#34;created&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>查看指定index所有doc</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url：<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_search
</span></span><span class=line><span class=cl>body<span class=o>(</span>也可以不指定<span class=o>)</span>：<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match_all&#34;</span>:<span class=o>{}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 2,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;E83dxHsBx8UYn7wDPx-g&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张三&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;数据库管理&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;李四&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>按照id查询index下指定文档</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/1
</span></span><span class=line><span class=cl>resp:
</span></span><span class=line><span class=cl>未找到情况
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;user&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;found&#34;</span>: <span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>查找到
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 2,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 2,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;found&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;李四&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>修改文档</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/1
</span></span><span class=line><span class=cl><span class=c1>#如果指定的filed比mapping的字段少，那么其余字段都会被置空</span>
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;lisi&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;经理&#34;</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;男&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 3,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=s2>&#34;updated&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 3,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ol start=11><li><p>修改文档单个字段</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_update/1
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;doc&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;user&#34;</span>:<span class=s2>&#34;李四&#34;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 4,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=s2>&#34;updated&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 4,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>删除文档</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/E83dxHsBx8UYn7wDPx-g
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;E83dxHsBx8UYn7wDPx-g&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 2,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=s2>&#34;deleted&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 6,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>但条件查询,默认一次返回10条记录，可以通过size指定,可以通过from指定偏移量</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/_search或<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_search
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;size&#34;</span>: 5,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;from&#34;</span>: <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 1,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1.2576691,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;G80hyXsBx8UYn7wDUh9z&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1.2576691,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张三&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;数据库管理&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#如果查询参数用多个且用空格分开，那么es认为它们是or的关系</span>
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张 五&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;size&#34;</span>: 5,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;from&#34;</span>: <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#如以上查询条件可匹配user为张三、王五的记录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#如果多个关键词是and的关系，那么要使用bool查询器</span>
</span></span><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_search
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;bool&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;must&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>				<span class=o>{</span><span class=s2>&#34;match&#34;</span>:<span class=o>{</span><span class=s2>&#34;user&#34;</span>:<span class=s2>&#34;张&#34;</span><span class=o>}}</span>,
</span></span><span class=line><span class=cl>				<span class=o>{</span><span class=s2>&#34;match&#34;</span>:<span class=o>{</span><span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;管理&#34;</span><span class=o>}}</span>
</span></span><span class=line><span class=cl>			<span class=o>]</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#以上查询条件可匹配user中包含张、desc中包含管理的记录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#精确匹配field</span>
</span></span><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_search
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;terms&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>: <span class=o>[</span><span class=s2>&#34;tom&#34;</span>, <span class=s2>&#34;jack&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 2,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;jack&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;2&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;tom&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#精确匹配只适用于英文，中文只能用模糊匹配</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match&#34;</span>:<span class=o>{</span><span class=s2>&#34;user&#34;</span>:<span class=s2>&#34;张三 王五&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>查询文档指定字段</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/_search
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;_source&#34;</span>:<span class=o>[</span><span class=s2>&#34;user&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 6,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;G80hyXsBx8UYn7wDUh9z&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张三&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;HM0hyXsBx8UYn7wDlB8-&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;王五&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;jack&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;2&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;tom&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;3&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;mary&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;myd&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;myd&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>按_id查询文档</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/1
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 10,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 13,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;found&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;jack&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>高亮显示搜索词</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/_search
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;highlight&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;fields&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>:<span class=o>{}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 74,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 1,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1.5108216,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;G80hyXsBx8UYn7wDUh9z&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1.5108216,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张三&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;数据库管理&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;highlight&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;&lt;em&gt;张&lt;/em&gt;三&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=o>]</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>短语查询(phrase search)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#针对英文有效，中文情况下无效</span>
</span></span><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/_search
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match_phrase&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>:<span class=s2>&#34;tom&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 1,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1.4417952,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;2&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1.4417952,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;tom&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>条件删除文档</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/accounts222/_doc/_delete_by_query	post
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;match&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;user&#34;</span>:<span class=s2>&#34;myd&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 11,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;deleted&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;batches&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;version_conflicts&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;noops&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;retries&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;bulk&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;search&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;throttled_millis&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;requests_per_second&#34;</span>: -1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;throttled_until_millis&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;failures&#34;</span>: <span class=o>[]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>路径通配符,通配符支持*和？*匹配任意多字符包括空字符，?只能匹配一个字符</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/account*/_doc/_search	get
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 2,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 6,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;account&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;Hc3YznsBx8UYn7wDPB9x&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;myd&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;age&#34;</span>: <span class=m>20</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;G80hyXsBx8UYn7wDUh9z&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;张三&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;数据库管理&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;HM0hyXsBx8UYn7wDlB8-&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;王五&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;经理&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;manager&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;jack&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;2&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;tom&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;accounts222&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;3&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;user&#34;</span>: <span class=s2>&#34;mary&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;工程师&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;desc&#34;</span>: <span class=s2>&#34;开发&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>查询条件通配符</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/account/_doc/_search	get
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;query&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;wildcard&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;m*&#34;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 13,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 2,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;account&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;Hc3YznsBx8UYn7wDPB9x&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;myd&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;age&#34;</span>: <span class=m>20</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;account&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;Hs3bznsBx8UYn7wD9x93&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;mary&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;age&#34;</span>: <span class=m>30</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>聚合查询</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#查询最大值</span>
</span></span><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/account/_doc/_search	get
</span></span><span class=line><span class=cl><span class=c1>#&#34;size&#34;: 0去除hit.hit中的数据</span>
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;aggs&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;max_age&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;max&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>				<span class=s2>&#34;field&#34;</span>:<span class=s2>&#34;age&#34;</span>
</span></span><span class=line><span class=cl>			<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;size&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 5,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: null,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;aggregations&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_age&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: <span class=m>30</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li></ol><h2 id=go-api操作>go api操作<a hidden class=anchor aria-hidden=true href=#go-api操作>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;encoding/json&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;reflect&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>es</span> <span class=s>&#34;github.com/olivere/elastic/v7&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Tweet</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>User</span>     <span class=kt>string</span>           <span class=s>`json:&#34;user&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Message</span>  <span class=kt>string</span>           <span class=s>`json:&#34;message&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Retweets</span> <span class=kt>int</span>              <span class=s>`json:&#34;retweets&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Image</span>    <span class=kt>string</span>           <span class=s>`json:&#34;image,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Created</span>  <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>        <span class=s>`json:&#34;created,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Tags</span>     <span class=p>[]</span><span class=kt>string</span>         <span class=s>`json:&#34;tags,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Location</span> <span class=kt>string</span>           <span class=s>`json:&#34;location,omitempty&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Suggest</span>  <span class=o>*</span><span class=nx>es</span><span class=p>.</span><span class=nx>SuggestField</span> <span class=s>`json:&#34;suggest_field,omitempty&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=nx>mapping</span> <span class=p>=</span> <span class=s>`
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s>	&#34;settings&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>		&#34;number_of_shards&#34;: 1,
</span></span></span><span class=line><span class=cl><span class=s>		&#34;number_of_replicas&#34;: 0
</span></span></span><span class=line><span class=cl><span class=s>	},
</span></span></span><span class=line><span class=cl><span class=s>	&#34;mappings&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>			&#34;properties&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>				&#34;user&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;keyword&#34;
</span></span></span><span class=line><span class=cl><span class=s>				},
</span></span></span><span class=line><span class=cl><span class=s>				&#34;message&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;text&#34;,
</span></span></span><span class=line><span class=cl><span class=s>					&#34;store&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s>					&#34;fielddata&#34;: true
</span></span></span><span class=line><span class=cl><span class=s>				},
</span></span></span><span class=line><span class=cl><span class=s>				&#34;image&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;keyword&#34;
</span></span></span><span class=line><span class=cl><span class=s>				},
</span></span></span><span class=line><span class=cl><span class=s>				&#34;created&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;date&#34;
</span></span></span><span class=line><span class=cl><span class=s>				},
</span></span></span><span class=line><span class=cl><span class=s>				&#34;tags&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;keyword&#34;
</span></span></span><span class=line><span class=cl><span class=s>				},
</span></span></span><span class=line><span class=cl><span class=s>				&#34;location&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;geo_point&#34;
</span></span></span><span class=line><span class=cl><span class=s>				},
</span></span></span><span class=line><span class=cl><span class=s>				&#34;suggest_field&#34;:{
</span></span></span><span class=line><span class=cl><span class=s>					&#34;type&#34;:&#34;completion&#34;
</span></span></span><span class=line><span class=cl><span class=s>				}
</span></span></span><span class=line><span class=cl><span class=s>			}
</span></span></span><span class=line><span class=cl><span class=s>	}
</span></span></span><span class=line><span class=cl><span class=s>}`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>host</span> <span class=o>:=</span> <span class=s>&#34;http://139.198.11.13:9200&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>es</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>es</span><span class=p>.</span><span class=nf>SetURL</span><span class=p>(</span><span class=nx>host</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>es</span><span class=p>.</span><span class=nf>SetSniff</span><span class=p>(</span><span class=kc>false</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>es</span><span class=p>.</span><span class=nf>SetHealthcheck</span><span class=p>(</span><span class=kc>false</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// client, err := es.NewClientFromConfig(&amp;config.Config{
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 	URL: &#34;http://139.198.11.13:9200&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// })
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;connect to es success.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>version</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>ElasticsearchVersion</span><span class=p>(</span><span class=nx>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;version:&#34;</span><span class=p>,</span> <span class=nx>version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Ping</span><span class=p>(</span><span class=nx>host</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;version:%s \n code:%d \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>.</span><span class=nx>Version</span><span class=p>.</span><span class=nx>Number</span><span class=p>,</span> <span class=nx>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>exists</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>IndexExists</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;twitter exists:&#34;</span><span class=p>,</span> <span class=nx>exists</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>exists</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>CreateIndex</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>BodyString</span><span class=p>(</span><span class=nx>mapping</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>res</span><span class=p>.</span><span class=nx>Acknowledged</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;create index twitter faild&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;create index twitter success&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//add a doc to twitter use json
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>tweet1</span> <span class=o>:=</span> <span class=nx>Tweet</span><span class=p>{</span><span class=nx>User</span><span class=p>:</span> <span class=s>&#34;olivere&#34;</span><span class=p>,</span> <span class=nx>Message</span><span class=p>:</span> <span class=s>&#34;Take Five&#34;</span><span class=p>,</span> <span class=nx>Retweets</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>put1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Index</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>BodyJson</span><span class=p>(</span><span class=nx>tweet1</span><span class=p>).</span><span class=nf>Id</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;add tweet %s to index %s type is %s \n&#34;</span><span class=p>,</span> <span class=nx>put1</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>put1</span><span class=p>.</span><span class=nx>Index</span><span class=p>,</span> <span class=nx>put1</span><span class=p>.</span><span class=nx>Type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//add a doc to twitter use string
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>tweet2</span> <span class=o>:=</span> <span class=s>`{&#34;user&#34; : &#34;olivere&#34;, &#34;message&#34; : &#34;aaa&#34;}`</span>
</span></span><span class=line><span class=cl>	<span class=nx>put2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Index</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>Type</span><span class=p>(</span><span class=s>&#34;_doc&#34;</span><span class=p>).</span><span class=nf>Id</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>).</span><span class=nf>BodyString</span><span class=p>(</span><span class=nx>tweet2</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;add tweet %s to index %s type is %s \n&#34;</span><span class=p>,</span> <span class=nx>put2</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>put2</span><span class=p>.</span><span class=nx>Index</span><span class=p>,</span> <span class=nx>put2</span><span class=p>.</span><span class=nx>Type</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//get doc tweet specified id
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>get1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Get</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>Type</span><span class=p>(</span><span class=s>&#34;_doc&#34;</span><span class=p>).</span><span class=nf>Id</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>get1</span><span class=p>.</span><span class=nx>Found</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;doc %s in index %s founded, version is %d, doc: %s \n&#34;</span><span class=p>,</span> <span class=nx>get1</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>get1</span><span class=p>.</span><span class=nx>Index</span><span class=p>,</span> <span class=nx>get1</span><span class=p>.</span><span class=nx>Version</span><span class=p>,</span> <span class=nx>get1</span><span class=p>.</span><span class=nx>Source</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;doc 1 in index twitter not found&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>termQ</span> <span class=o>:=</span> <span class=nx>es</span><span class=p>.</span><span class=nf>NewTermQuery</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>,</span> <span class=s>&#34;olivere&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>search1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Search</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>Query</span><span class=p>(</span><span class=nx>termQ</span><span class=p>).</span><span class=nf>From</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nf>Size</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nf>Pretty</span><span class=p>(</span><span class=kc>true</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;term query took %d ms \n&#34;</span><span class=p>,</span> <span class=nx>search1</span><span class=p>.</span><span class=nx>TookInMillis</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>ttyp</span> <span class=nx>Tweet</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>item</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>search1</span><span class=p>.</span><span class=nf>Each</span><span class=p>(</span><span class=nx>reflect</span><span class=p>.</span><span class=nf>TypeOf</span><span class=p>(</span><span class=nx>ttyp</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>t</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>item</span><span class=p>.(</span><span class=nx>Tweet</span><span class=p>);</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Tweet by %s: %s \n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;---Tweet: %#v \n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;found a total of %d tweets \n&#34;</span><span class=p>,</span> <span class=nx>search1</span><span class=p>.</span><span class=nf>TotalHits</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>search1</span><span class=p>.</span><span class=nx>Hits</span><span class=p>.</span><span class=nx>TotalHits</span><span class=p>.</span><span class=nx>Value</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;found a total of %d tweets \n&#34;</span><span class=p>,</span> <span class=nx>search1</span><span class=p>.</span><span class=nx>Hits</span><span class=p>.</span><span class=nx>TotalHits</span><span class=p>.</span><span class=nx>Value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>hit</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>search1</span><span class=p>.</span><span class=nx>Hits</span><span class=p>.</span><span class=nx>Hits</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kd>var</span> <span class=nx>t</span> <span class=nx>Tweet</span>
</span></span><span class=line><span class=cl>			<span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>hit</span><span class=p>.</span><span class=nx>Source</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;tweet by %s : %s \n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=nx>t</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;===Tweet: %#v \n&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;found no tweets&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//update doc
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>update1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Update</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>Id</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>).</span><span class=nf>Script</span><span class=p>(</span><span class=nx>es</span><span class=p>.</span><span class=nf>NewScriptInline</span><span class=p>(</span><span class=s>&#34;ctx._source.retweets += params.num&#34;</span><span class=p>).</span><span class=nf>Lang</span><span class=p>(</span><span class=s>&#34;painless&#34;</span><span class=p>).</span><span class=nf>Param</span><span class=p>(</span><span class=s>&#34;num&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Upsert</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span><span class=s>&#34;retweets&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>}).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;new version of tweet %q is now %d\n&#34;</span><span class=p>,</span> <span class=nx>update1</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>update1</span><span class=p>.</span><span class=nx>Version</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//del doc
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=nx>del1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Delete</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=s>&#34;twitter&#34;</span><span class=p>).</span><span class=nf>Id</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;delete status: %d \n&#34;</span><span class=p>,</span> <span class=nx>del1</span><span class=p>.</span><span class=nx>Status</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=es中的shardprimary-shard和replicareplica-shard>es中的shard(primary shard)和replica(replica shard)<a hidden class=anchor aria-hidden=true href=#es中的shardprimary-shard和replicareplica-shard>#</a></h2><p>es是集群工作的，如果只有一台机器的话那么整个集群就只有这一台，es集群按照index来划分数据，在创建index的时候如果什么参数都不指定，那么默认创建一个shard(primary shard)和1个replica(replica shard),但是一个shard对应的replica不能在同一台机器上，如果是一台机器的集群，那么replica有没有机器去分配，那么该index的状态就会是yellow,一个index的状态由green、yellow、red三种，green状态是index的所有shard和replica都正常，yellow状态是index的所有shard正常，部分或全部replica不正常，red状态则是有shard不正常</p><p>在创建index的时候可以指定shard、replicad 的个数，使用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;settings&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;number_of_shards&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nt>&#34;number_of_replicas&#34;</span><span class=p>:</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里要注意的是<code>number_of_replicas</code>的数量不是总的replica数量，replica是针对shard而言的，也就是这里的<code>number_of_replicas</code>是指每个shard有多少个replica</p><p>如果在创建index时指定了多个shard而es集群只有单台机器，那么有所的shard会存在同一台机器上，当有新的机器加入es集群，这些shard会移动到新加入的es节点上</p><p>一个index的多个replica不能在es集群的同一个节点上</p><h2 id=es中创建doc时存储路由>es中创建doc时存储路由<a hidden class=anchor aria-hidden=true href=#es中创建doc时存储路由>#</a></h2><p>在es中一个index有多个primary，每个doc都是存储到一个指定的primary，那么在创建doc的时候是如何选择该doc是要保存在那个primary中的，在es中选择doc存储的primary是通过routing来决定的，默认情况下routing为_id，具体计算存那个primary的规则为：hash(routing) % number_primarys 来得到该文档存放的primary下标，在创建doc的时候也可以指定routing来手动指定要存放的位置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/testroute1/_doc/2?routing<span class=o>=</span>b	PUT
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;b&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;testroute1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;2&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_version&#34;</span>: 1,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;result&#34;</span>: <span class=s2>&#34;created&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_seq_no&#34;</span>: 0,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_primary_term&#34;</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>查询doc并指定routing</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/testroute1/_doc/_search?routing<span class=o>=</span>a	GET
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;took&#34;</span>: 422,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;timed_out&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_shards&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;successful&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;skipped&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hits&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;total&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;value&#34;</span>: 1,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;relation&#34;</span>: <span class=s2>&#34;eq&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;max_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hits&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;testroute1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;1&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_score&#34;</span>: 1,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_routing&#34;</span>: <span class=s2>&#34;a&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;_source&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;name&#34;</span>: <span class=s2>&#34;a&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/testroute1/_doc/2?routing<span class=o>=</span>a GET
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_index&#34;</span>: <span class=s2>&#34;testroute1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_type&#34;</span>: <span class=s2>&#34;_doc&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;_id&#34;</span>: <span class=s2>&#34;2&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;found&#34;</span>: <span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>创建index的时候指定doc增删改查都必须带上routing</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>url:<span class=o>{{</span>localhost<span class=o>}}</span>:9200/testroute2	PUT
</span></span><span class=line><span class=cl>body:<span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;settings&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;number_of_shards&#34;</span>:2,
</span></span><span class=line><span class=cl>		<span class=s2>&#34;number_of_replicas&#34;</span>:2
</span></span><span class=line><span class=cl>	<span class=o>}</span>,
</span></span><span class=line><span class=cl>	<span class=s2>&#34;mappings&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=s2>&#34;_routing&#34;</span>:<span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;required&#34;</span>:true
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>resp:<span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;acknowledged&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;shards_acknowledged&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;index&#34;</span>: <span class=s2>&#34;testroute2&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://moyuduo.github.io/posts/edgex/><span class=title>« Prev</span><br><span>edgex</span></a>
<a class=next href=https://moyuduo.github.io/posts/equals%E5%92%8Chashcode%E6%96%B9%E6%B3%95/><span class=title>Next »</span><br><span>equals和hashCode方法</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch相关 on twitter" href="https://twitter.com/intent/tweet/?text=elasticsearch%e7%9b%b8%e5%85%b3&url=https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch相关 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f&title=elasticsearch%e7%9b%b8%e5%85%b3&summary=elasticsearch%e7%9b%b8%e5%85%b3&source=https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch相关 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f&title=elasticsearch%e7%9b%b8%e5%85%b3"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch相关 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch相关 on whatsapp" href="https://api.whatsapp.com/send?text=elasticsearch%e7%9b%b8%e5%85%b3%20-%20https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share elasticsearch相关 on telegram" href="https://telegram.me/share/url?text=elasticsearch%e7%9b%b8%e5%85%b3&url=https%3a%2f%2fmoyuduo.github.io%2fposts%2felasticsearch%25E7%259B%25B8%25E5%2585%25B3%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://moyuduo.github.io/>Moyuduo's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>