<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Postgresql相关 | Moyuduo's Blog</title><meta name=keywords content><meta name=description content="Postgresql相关 安装 安装不要使用yum安装，因为版本很老
#centos7 x84 arch 安装 postgresql13 # Install the repository RPM: sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Install PostgreSQL: sudo yum install -y postgresql13-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-13/bin/postgresql-13-setup initdb sudo systemctl enable postgresql-13 sudo systemctl start postgresql-13 #其他版本参考 https://www.postgresql.org/download/linux/ 修改配置文件支持远程连接 #使用ps查看postgresql是否启动，并获取数据保存路径	/var/lib/pgsql/13/data/ [root@i-u8fxb68q data]# ps -ef|grep postgre root 9821 7321 0 10:40 pts/0 00:00:00 su postgres postgres 9822 9821 0 10:40 pts/0 00:00:00 bash root 10896 9990 0 10:58 pts/0 00:00:00 su postgres postgres 10897 10896 0 10:58 pts/0 00:00:00 bash postgres 13020 1 0 11:27 ?"><meta name=author content="Me"><link rel=canonical href=https://moyuduo.github.io/posts/postgresql%E7%9B%B8%E5%85%B3/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Postgresql相关"><meta property="og:description" content="Postgresql相关 安装 安装不要使用yum安装，因为版本很老
#centos7 x84 arch 安装 postgresql13 # Install the repository RPM: sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Install PostgreSQL: sudo yum install -y postgresql13-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-13/bin/postgresql-13-setup initdb sudo systemctl enable postgresql-13 sudo systemctl start postgresql-13 #其他版本参考 https://www.postgresql.org/download/linux/ 修改配置文件支持远程连接 #使用ps查看postgresql是否启动，并获取数据保存路径	/var/lib/pgsql/13/data/ [root@i-u8fxb68q data]# ps -ef|grep postgre root 9821 7321 0 10:40 pts/0 00:00:00 su postgres postgres 9822 9821 0 10:40 pts/0 00:00:00 bash root 10896 9990 0 10:58 pts/0 00:00:00 su postgres postgres 10897 10896 0 10:58 pts/0 00:00:00 bash postgres 13020 1 0 11:27 ?"><meta property="og:type" content="article"><meta property="og:url" content="https://moyuduo.github.io/posts/postgresql%E7%9B%B8%E5%85%B3/"><meta property="og:image" content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-27T16:16:14+08:00"><meta property="article:modified_time" content="2022-11-27T16:16:14+08:00"><meta property="og:site_name" content="Moyuduo's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://moyuduo.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Postgresql相关"><meta name=twitter:description content="Postgresql相关 安装 安装不要使用yum安装，因为版本很老
#centos7 x84 arch 安装 postgresql13 # Install the repository RPM: sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Install PostgreSQL: sudo yum install -y postgresql13-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-13/bin/postgresql-13-setup initdb sudo systemctl enable postgresql-13 sudo systemctl start postgresql-13 #其他版本参考 https://www.postgresql.org/download/linux/ 修改配置文件支持远程连接 #使用ps查看postgresql是否启动，并获取数据保存路径	/var/lib/pgsql/13/data/ [root@i-u8fxb68q data]# ps -ef|grep postgre root 9821 7321 0 10:40 pts/0 00:00:00 su postgres postgres 9822 9821 0 10:40 pts/0 00:00:00 bash root 10896 9990 0 10:58 pts/0 00:00:00 su postgres postgres 10897 10896 0 10:58 pts/0 00:00:00 bash postgres 13020 1 0 11:27 ?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://moyuduo.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Postgresql相关","item":"https://moyuduo.github.io/posts/postgresql%E7%9B%B8%E5%85%B3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Postgresql相关","name":"Postgresql相关","description":"Postgresql相关 安装 安装不要使用yum安装，因为版本很老\n#centos7 x84 arch 安装 postgresql13 # Install the repository RPM: sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Install PostgreSQL: sudo yum install -y postgresql13-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-13/bin/postgresql-13-setup initdb sudo systemctl enable postgresql-13 sudo systemctl start postgresql-13 #其他版本参考 https://www.postgresql.org/download/linux/ 修改配置文件支持远程连接 #使用ps查看postgresql是否启动，并获取数据保存路径\t/var/lib/pgsql/13/data/ [root@i-u8fxb68q data]# ps -ef|grep postgre root 9821 7321 0 10:40 pts/0 00:00:00 su postgres postgres 9822 9821 0 10:40 pts/0 00:00:00 bash root 10896 9990 0 10:58 pts/0 00:00:00 su postgres postgres 10897 10896 0 10:58 pts/0 00:00:00 bash postgres 13020 1 0 11:27 ?","keywords":[],"articleBody":"Postgresql相关 安装 安装不要使用yum安装，因为版本很老\n#centos7 x84 arch 安装 postgresql13 # Install the repository RPM: sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm # Install PostgreSQL: sudo yum install -y postgresql13-server # Optionally initialize the database and enable automatic start: sudo /usr/pgsql-13/bin/postgresql-13-setup initdb sudo systemctl enable postgresql-13 sudo systemctl start postgresql-13 #其他版本参考 https://www.postgresql.org/download/linux/ 修改配置文件支持远程连接 #使用ps查看postgresql是否启动，并获取数据保存路径\t/var/lib/pgsql/13/data/ [root@i-u8fxb68q data]# ps -ef|grep postgre root 9821 7321 0 10:40 pts/0 00:00:00 su postgres postgres 9822 9821 0 10:40 pts/0 00:00:00 bash root 10896 9990 0 10:58 pts/0 00:00:00 su postgres postgres 10897 10896 0 10:58 pts/0 00:00:00 bash postgres 13020 1 0 11:27 ? 00:00:00 /usr/pgsql-13/bin/postmaster -D /var/lib/pgsql/13/data/ postgres 13022 13020 0 11:27 ? 00:00:00 postgres: logger postgres 13024 13020 0 11:27 ? 00:00:00 postgres: checkpointer postgres 13025 13020 0 11:27 ? 00:00:00 postgres: background writer postgres 13026 13020 0 11:27 ? 00:00:00 postgres: walwriter postgres 13027 13020 0 11:27 ? 00:00:00 postgres: autovacuum launcher postgres 13028 13020 0 11:27 ? 00:00:00 postgres: stats collector postgres 13029 13020 0 11:27 ? 00:00:00 postgres: logical replication launcher root 13183 11285 0 11:30 pts/0 00:00:00 su postgres postgres 13184 13183 0 11:30 pts/0 00:00:00 bash postgres 13235 13020 0 11:31 ? 00:00:02 postgres: postgres postgres 110.191.179.192(24432) idle root 13642 13586 0 11:35 pts/0 00:00:00 grep --color=auto postgre 进入数据目录修改pg_hba.conf、postgresql.conf两个文件。\n修改pg_hba.conf可访问的ip地址\n修改postgresql.conf监听的范围,原本为注释的，修改并改为*\n修改密码 #切换用户 su postgres #进入客户端 psql #修改密码，出现ALTER ROLE即成功 alter user postgres with password '995072337@Lt'; ALTER ROLE 练习 #查看数据库 \\l #进入数据库 \\c dbname #查看当前数据库的表 \\d #查看表格信息 \\d tablename create database ttt; alter database ttt rename to t1; drop database ttt; drop database if exist ttt; create table stu2 ( id int, name varchar(30), birth date, score numeric(5,2) ); alter table stu2 rename id to bh; alter table stu2 alter column name type varchar(20); alter table stu2 drop column birth; alter table stu2 add column addr varchar(200); drop table stu2; drop table if exists stu2; insert into temp values(2, 3, 3.14, 9.99); #插入时最后一个字段的定义为numeric(5,2) 但是插入时其实我超范围了但是不会报错，值会被四舍五入 insert into temp values(2, 3, 3.14, 9.999); create table temp1( t time, d date, tm timestamp ); insert into temp1 values('10:10:10', '2021-08-20', '2021-08-20 10:10:10'); create table temp2( ch char(10), vch varchar(30), t text ); insert into temp2 values('litao', 'litao', 'litao'); select concat('#', ch, '#'), concat('#', vch, '#'), concat('#', t, '#') from temp2; #算数运算符 select 1+2, 1-2, 1*2, 1/2, 1%2; #比较运算符 #字符串和数字比较会把字符串转换成数字，null和任何类型比较都是null select 1\u003e2, 1\u003c2, 1\u003e=1, 1\u003c=2, 1=2, 1!=2, '2'=2, null=null, null=1; select 2 between 1 and 3; select 2 in (1, 2, 3); select 'abc' like 'a%', 'abc' like '_b_', 'abc' not like '%c'; # 1,y被当做真\t0，n被当做假 select not '1', not 'y', not '0', not 'n'; select '1' and 'y', '1' and 'n', '0' and 'n'; select '1' or 'y', '1' or 'n', '0' or 'n'; #索引 create index id_idx on stu(id); drop index id_idx; #视图 create view stu_view as select * from stu where age \u003c 20; select * from stu_view; select id, name from stu_view; drop view stu_view; #插入 insert into stu values(1, 'tom', 20, 'm'); insert into stu values(2, 'jack', 18, 'm'),(3, 'marry', 20, 'f'); insert into stu(id, name) values(5, 'moyuduo'); insert into stu(name, id) values('qqq', 6); insert into stu2 select * from stu where id = 1; #更新 update stu set age = 30 where id = 4; #删除 delete from stu where id = 1; delete from stu where age \u003c 20; delete from stu; #truncate不记录删除日志，不可恢复，但是速度快 truncate table stu; #约束 create table score2( id bigint primary key, #主键约束 course_name varchar(20), score decimal(2,2), sid bigint, constraint score2_fk foreign key(sid) references stu(id)\t#外键约束 ); alter table score add constraint score_pk primary key(id); alter table score add constraint score_fk foreign key(sid) references stu(id); alter table score3 alter column score set default(0.00); alter table score3 alter column score drop default; alter table score3 alter column course_name set not null; alter table score3 alter column course_name drop not null; #自增主键 create table test_pk1( id serial primary key, #serial自增 范围1 到 2147483647 name varchar(20) ); 数据类型 smallint:范围：-32768-32767,2字节 int：-2147483648-2147483647,4字节 real：表示6位十进制数进度 numeric：numeric(m,n)表示整数部分m位，小数部分n位 time:一日之内的时间，格式为'10:10:10' date:日期类型，格式为：‘2021-08-20’ timestamp:时间戳类型，格式为'2021-08-20 10:10:10’不能直接使用时间戳 char(n):定长字符串，如果插入的字符不足指定位数时，使用空白字符填充，检索效率比varchar高 varchar(n):边长字符串，如果插入的字符不足指定位数时，只存储值，不做其他操作 text:和varchar类似 管理工具 官网下载pgAdmin，免费\n下载好后在pgAdmin是有postgresql客户端的，在安装路径，如：F:\\v5\\runtime\\psql.exe，可以把这个文件配置到环境变量，就可以在cmd终端直接使用psql命名\n数据导入 导入命令：psql -h 139.198.11.13 -p5431 -d iot -U postgres -f F:\\sql脚本\\iot_device.sql\n-h指定ip地址，默认本地\n-p指定端口，默认5432\n-d指定数据库\n-U指定登录的用户\n执行命令后如果不是本地会要求输入密码\n从一个postgresql导出的数据如果在本地windows进行导入会出现编码转换错误：\n这是由于windows本地文件使用GBK进行编码，但是进行导入的postgresql数据库是UTF8编码，在windows上使用postgresql客户端进行文件传输并不会进行编码转换，直接使用的windows的GBK编码\ngo-pg type ( User struct { Id int64 Name string Emails []string tableName struct{} `sql:\"user\"` } Story struct { Id int64 Title string AuthorId int64 Author *User tableName struct{} `sql:\"story\"` } ) func (u User) String() string { return fmt.Sprintf(\"User\u003c%d %s %v\u003e\", u.Id, u.Name, u.Emails) } func (s Story) String() string { return fmt.Sprintf(\"Story\u003c%d %s %#v\u003e\", s.Id, s.Title, s.Author) } func connect() *pg.DB { db := pg.Connect(\u0026pg.Options{ Addr: \"139.198.11.13:5432\", User: \"postgres\", Password: \"995072337@Lt\", Database: \"test\", }) var n int _, err := db.QueryOne(pg.Scan(\u0026n), \"select 1\") if err != nil { panic(err) } return db } func createTables(db *pg.DB, tabs []interface{}) { for _, model := range tabs { err := db.CreateTable(model, \u0026orm.CreateTableOptions{ IfNotExists: true, FKConstraints: true, }) if err != nil { panic(err) } } } func delTables(db *pg.DB, tabs []interface{}) { for _, model := range tabs { err := db.DropTable(model, \u0026orm.DropTableOptions{ IfExists: true, Cascade: true, }) if err != nil { panic(err) } } } func insert(db *pg.DB) { u1 := \u0026User{ Name: \"u1\", Emails: []string{\"u1@163.com\", \"u1@qq.com\"}, } u2 := \u0026User{ Name: \"u2\", Emails: []string{\"u2@163.com\"}, } err := db.Insert(u1, u2) if err != nil { panic(err) } u3 := \u0026User{ Name: \"u3\", Emails: []string{\"u3@163.com\"}, } u4 := \u0026User{ Name: \"u4\", Emails: []string{\"u4@163.com\"}, } res, err := db.Model(u3, u4).Insert() if err != nil { panic(err) } fmt.Printf(\"%#v \\n\", res) u5 := \u0026User{ Name: \"u5\", Emails: []string{\"u5@163.com\"}, } u6 := \u0026User{ Name: \"u6\", Emails: []string{\"u6@163.com\"}, } users := make([]*User, 0) users = append(users, u5) users = append(users, u6) res, err = db.Model(\u0026users).Insert() if err != nil { panic(err) } fmt.Printf(\"%#v \\n\", res) } func delUserRecord(db *pg.DB) { //按主键删除 err := db.Delete(\u0026User{ Id: 2, Name: \"u2\", Emails: []string{\"u2@163.com\"}, }) if err != nil { panic(err) } res, err := db.Model(\u0026User{}).Where(\"id in (?)\", pg.In([]int64{3, 4})).Delete() if err != nil { panic(err) } fmt.Printf(\"%#v \\n\", res) } func delUserRecord2(db *pg.DB) { err := db.Delete(\u0026User{ Id: 1, }) if err != nil { panic(err) } } func updateUserRecord(db *pg.DB) { user := User{ Id: 5, Name: \"u555\", } err := db.Update(\u0026user) if err != nil { panic(err) } } func updateUserRecord2(db *pg.DB) { user := User{ Id: 6, Name: \"u666\", } res, err := db.Model(\u0026user).Set(\"name=?\", user.Name).WherePK().Update() if err != nil { panic(err) } fmt.Printf(\"%#v \\n\", res) } func updateUserRecord3(db *pg.DB) { user := User{ Id: 7, Name: \"u777\", } res, err := db.Model(\u0026user).Column(\"name\").WherePK().Update() if err != nil { panic(err) } fmt.Printf(\"%#v \\n\", res) } func updateUserRecord4(db *pg.DB) { user := User{ Id: 8, Name: \"u888\", } res, err := db.Model(\u0026user).Set(\"name=?name\").WherePK().Update() if err != nil { panic(err) } fmt.Printf(\"%#v \\n\", res) } func query1(db *pg.DB) { var user User res, err := db.Query(\u0026user, \"select * from users where id = ?\", 6) if err != nil { panic(err) } fmt.Printf(\"%#v %#v \\n\", user, res) } func query2(db *pg.DB) { var user User //如果记过有多行 panic: pg: multiple rows in result set res, err := db.QueryOne(\u0026user, \"select * from users where id \u003c ?\", 10) if err != nil { panic(err) } fmt.Printf(\"%#v %#v \\n\", user, res) } func query3(db *pg.DB) { user := User{ Id: 6, } err := db.Model(\u0026user).Where(\"id = ?id\").Select() if err != nil { panic(err) } fmt.Println(user) } func query4(db *pg.DB) { user := User{ Id: 6, } err := db.Model(\u0026user).Column(\"id\", \"name\").Where(\"id = ?id\").Select() if err != nil { panic(err) } fmt.Println(user) } func query5(db *pg.DB) { var id int64 var name string err := db.Model((*User)(nil)).Column(\"id\", \"name\").Where(\"id = ?\", 6).Select(\u0026id, \u0026name) if err != nil { panic(err) } fmt.Println(id, name) } func query6(db *pg.DB) { user := User{} err := db.Model(\u0026user).Where(\"id = ? and name = ?\", 6, \"u666\").Select() // err := db.Model(\u0026user).Where(\"id = ?\", 6).Where(\"name = ?\", \"u666\").Select() if err != nil { panic(err) } fmt.Println(user) } func query7(db *pg.DB) { user := User{ Id: 6, Name: \"u777\", } err := db.Model(\u0026user).Where(\"id = ?id\").WhereOr(\"name = ?name\").Limit(1).Select() if err != nil { panic(err) } fmt.Println(user) } func query8(db *pg.DB) { var users []User err := db.Model((*User)(nil)).Where(\"id = ?\", 6).WhereOr(\"name = ?\", \"u777\").Select(\u0026users) if err != nil { panic(err) } fmt.Println(users) } func query9(db *pg.DB) { var users []User err := db.Model((*User)(nil)).Where(\"id \u003c ?\", 10). WhereGroup(func(q *orm.Query) (*orm.Query, error) { q = q.Where(\"name = ?\", \"u666\"). WhereOr(\"name = ?\", \"u777\") return q, nil }).Select(\u0026users) if err != nil { panic(err) } fmt.Println(users) } func query10(db *pg.DB) { var user []User err := db.Model((*User)(nil)).Where(\"id in (?)\", pg.In([]int64{6, 7})).Select(\u0026user) if err != nil { panic(err) } fmt.Println(user) } func query11(db *pg.DB) { n, err := db.Model((*User)(nil)).Where(\"id \u003c ?\", 10).Count() if err != nil { panic(err) } fmt.Println(n) } func query12(db *pg.DB) { var users []User err := db.Model((*User)(nil)).Where(\"id \u003c ?\", 10).Order(\"id desc\").Select(\u0026users) if err != nil { panic(err) } fmt.Println(users) } func query13(db *pg.DB) { var ids []int64 err := db.Model((*User)(nil)).ColumnExpr(\"array_agg(id)\").Select(pg.Array(\u0026ids)) if err != nil { panic(err) } fmt.Println(ids) } func query14(db *pg.DB) { s := Story{} // err := db.Model(\u0026s).Relation(\"Author\").Where(\"story.id = ?\", 1).Select() err := db.Model(\u0026s).Relation(\"Author\", func(q *orm.Query) (*orm.Query, error) { return q.Where(\"story.id = ?\", 1), nil }).Select() if err != nil { panic(err) } fmt.Println(s) } func query15(db *pg.DB) { var ss []Story err := db.Model(\u0026ss).Column(\"story.*\").Relation(\"Author\").Select() if err != nil { panic(err) } fmt.Println(ss) } func query16(db *pg.DB) { exist, err := db.Model((*User)(nil)).Where(\"id = ?\", 1).Exists() if err != nil { panic(err) } fmt.Println(exist) } func query17(db *pg.DB) { db.Model((*User)(nil)).Order(\"id desc\").ForEach(func(u *User) error { fmt.Println(u) return nil }) } ","wordCount":"1554","inLanguage":"en","datePublished":"2022-11-27T16:16:14+08:00","dateModified":"2022-11-27T16:16:14+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://moyuduo.github.io/posts/postgresql%E7%9B%B8%E5%85%B3/"},"publisher":{"@type":"Organization","name":"Moyuduo's Blog","logo":{"@type":"ImageObject","url":"https://moyuduo.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://moyuduo.github.io/ accesskey=h title="Moyuduo's Blog (Alt + H)"><img src=https://moyuduo.github.io/apple-touch-icon.png alt aria-label=logo height=35>Moyuduo's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://moyuduo.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://moyuduo.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://moyuduo.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://moyuduo.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Postgresql相关</h1></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#安装>安装</a></li><li><a href=#修改配置文件支持远程连接>修改配置文件支持远程连接</a></li><li><a href=#修改密码>修改密码</a></li><li><a href=#练习>练习</a></li><li><a href=#数据类型>数据类型</a></li><li><a href=#管理工具>管理工具</a></li><li><a href=#数据导入>数据导入</a></li><li><a href=#go-pg>go-pg</a></li></ul></nav></div></details></div><div class=post-content><h1 id=postgresql相关>Postgresql相关<a hidden class=anchor aria-hidden=true href=#postgresql相关>#</a></h1><h2 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h2><p>安装不要使用yum安装，因为版本很老</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#centos7 x84 arch 安装 postgresql13</span>
</span></span><span class=line><span class=cl><span class=c1># Install the repository RPM:</span>
</span></span><span class=line><span class=cl>sudo yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Install PostgreSQL:</span>
</span></span><span class=line><span class=cl>sudo yum install -y postgresql13-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Optionally initialize the database and enable automatic start:</span>
</span></span><span class=line><span class=cl>sudo /usr/pgsql-13/bin/postgresql-13-setup initdb
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> postgresql-13
</span></span><span class=line><span class=cl>sudo systemctl start postgresql-13
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#其他版本参考</span>
</span></span><span class=line><span class=cl>https://www.postgresql.org/download/linux/
</span></span></code></pre></div><h2 id=修改配置文件支持远程连接>修改配置文件支持远程连接<a hidden class=anchor aria-hidden=true href=#修改配置文件支持远程连接>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#使用ps查看postgresql是否启动，并获取数据保存路径	/var/lib/pgsql/13/data/</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@i-u8fxb68q data<span class=o>]</span><span class=c1># ps -ef|grep postgre</span>
</span></span><span class=line><span class=cl>root      <span class=m>9821</span>  <span class=m>7321</span>  <span class=m>0</span> 10:40 pts/0    00:00:00 su postgres
</span></span><span class=line><span class=cl>postgres  <span class=m>9822</span>  <span class=m>9821</span>  <span class=m>0</span> 10:40 pts/0    00:00:00 bash
</span></span><span class=line><span class=cl>root     <span class=m>10896</span>  <span class=m>9990</span>  <span class=m>0</span> 10:58 pts/0    00:00:00 su postgres
</span></span><span class=line><span class=cl>postgres <span class=m>10897</span> <span class=m>10896</span>  <span class=m>0</span> 10:58 pts/0    00:00:00 bash
</span></span><span class=line><span class=cl>postgres <span class=m>13020</span>     <span class=m>1</span>  <span class=m>0</span> 11:27 ?        00:00:00 /usr/pgsql-13/bin/postmaster -D /var/lib/pgsql/13/data/
</span></span><span class=line><span class=cl>postgres <span class=m>13022</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: logger 
</span></span><span class=line><span class=cl>postgres <span class=m>13024</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: checkpointer 
</span></span><span class=line><span class=cl>postgres <span class=m>13025</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: background writer 
</span></span><span class=line><span class=cl>postgres <span class=m>13026</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: walwriter 
</span></span><span class=line><span class=cl>postgres <span class=m>13027</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: autovacuum launcher 
</span></span><span class=line><span class=cl>postgres <span class=m>13028</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: stats collector 
</span></span><span class=line><span class=cl>postgres <span class=m>13029</span> <span class=m>13020</span>  <span class=m>0</span> 11:27 ?        00:00:00 postgres: logical replication launcher 
</span></span><span class=line><span class=cl>root     <span class=m>13183</span> <span class=m>11285</span>  <span class=m>0</span> 11:30 pts/0    00:00:00 su postgres
</span></span><span class=line><span class=cl>postgres <span class=m>13184</span> <span class=m>13183</span>  <span class=m>0</span> 11:30 pts/0    00:00:00 bash
</span></span><span class=line><span class=cl>postgres <span class=m>13235</span> <span class=m>13020</span>  <span class=m>0</span> 11:31 ?        00:00:02 postgres: postgres postgres 110.191.179.192<span class=o>(</span>24432<span class=o>)</span> idle
</span></span><span class=line><span class=cl>root     <span class=m>13642</span> <span class=m>13586</span>  <span class=m>0</span> 11:35 pts/0    00:00:00 grep --color<span class=o>=</span>auto postgre
</span></span></code></pre></div><p>进入数据目录修改pg_hba.conf、postgresql.conf两个文件。</p><p>修改pg_hba.conf可访问的ip地址</p><p><img loading=lazy src=./images/Snipaste_2021-08-20_11-38-09.jpg alt></p><p>修改postgresql.conf监听的范围,原本为注释的，修改并改为*</p><p><img loading=lazy src=./images/Snipaste_2021-08-20_11-40-34.jpg alt></p><h2 id=修改密码>修改密码<a hidden class=anchor aria-hidden=true href=#修改密码>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#切换用户</span>
</span></span><span class=line><span class=cl>su postgres
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#进入客户端</span>
</span></span><span class=line><span class=cl>psql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#修改密码，出现ALTER ROLE即成功</span>
</span></span><span class=line><span class=cl>alter user postgres with password <span class=s1>&#39;995072337@Lt&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER ROLE
</span></span></code></pre></div><h2 id=练习>练习<a hidden class=anchor aria-hidden=true href=#练习>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>查看数据库</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>l</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>进入数据库</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=k>c</span><span class=w> </span><span class=n>dbname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>查看当前数据库的表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>d</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>查看表格信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>\</span><span class=n>d</span><span class=w> </span><span class=n>tablename</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>ttt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>ttt</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>t1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=n>ttt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>exist</span><span class=w> </span><span class=n>ttt</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu2</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>name</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>birth</span><span class=w> </span><span class=nb>date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>score</span><span class=w> </span><span class=nb>numeric</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu2</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>bh</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu2</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>type</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu2</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>birth</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu2</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>addr</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>200</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=k>exists</span><span class=w> </span><span class=n>stu2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>temp</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>9</span><span class=p>.</span><span class=mi>99</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>插入时最后一个字段的定义为</span><span class=nb>numeric</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=err>但是插入时其实我超范围了但是不会报错，值会被四舍五入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>temp</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>.</span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=mi>9</span><span class=p>.</span><span class=mi>999</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>temp1</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>t</span><span class=w> </span><span class=n>time</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>d</span><span class=w> </span><span class=nb>date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>tm</span><span class=w> </span><span class=k>timestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>temp1</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=s1>&#39;10:10:10&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2021-08-20&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2021-08-20 10:10:10&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>temp2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>ch</span><span class=w> </span><span class=nb>char</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>vch</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>t</span><span class=w> </span><span class=nb>text</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>temp2</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=s1>&#39;litao&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;litao&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;litao&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>,</span><span class=w> </span><span class=n>ch</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;#&#39;</span><span class=p>),</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>,</span><span class=w> </span><span class=n>vch</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;#&#39;</span><span class=p>),</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;#&#39;</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>temp2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>算数运算符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>*</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>%</span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>比较运算符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>字符串和数字比较会把字符串转换成数字，</span><span class=n>null</span><span class=err>和任何类型比较都是</span><span class=k>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=o>&gt;</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>&lt;</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>&lt;=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>!=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=o>=</span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>between</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=s1>&#39;abc&#39;</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;a%&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;abc&#39;</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;_b_&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;abc&#39;</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;%c&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>y</span><span class=err>被当做真</span><span class=w>	</span><span class=mi>0</span><span class=err>，</span><span class=n>n</span><span class=err>被当做假</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=s1>&#39;y&#39;</span><span class=p>,</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=s1>&#39;n&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=s1>&#39;y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=s1>&#39;n&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=s1>&#39;n&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=s1>&#39;y&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=s1>&#39;n&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;0&#39;</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=s1>&#39;n&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=n>id_idx</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>stu</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>index</span><span class=w> </span><span class=n>id_idx</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>视图</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>view</span><span class=w> </span><span class=n>stu_view</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu_view</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu_view</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>drop</span><span class=w> </span><span class=k>view</span><span class=w> </span><span class=n>stu_view</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>插入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;tom&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;m&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;jack&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;m&#39;</span><span class=p>),(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;marry&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;f&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>stu</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;moyuduo&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>stu</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=s1>&#39;qqq&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>stu2</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>更新</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>update</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>删除</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>20</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>stu</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=n>truncate</span><span class=err>不记录删除日志，不可恢复，但是速度快</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>truncate</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>stu</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>id</span><span class=w> </span><span class=nb>bigint</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>,</span><span class=w> </span><span class=o>#</span><span class=err>主键约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>course_name</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>score</span><span class=w> </span><span class=nb>decimal</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>sid</span><span class=w> </span><span class=nb>bigint</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>constraint</span><span class=w> </span><span class=n>score2_fk</span><span class=w> </span><span class=k>foreign</span><span class=w> </span><span class=k>key</span><span class=p>(</span><span class=n>sid</span><span class=p>)</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=n>stu</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>	</span><span class=o>#</span><span class=err>外键约束</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=n>score_pk</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=k>constraint</span><span class=w> </span><span class=n>score_fk</span><span class=w> </span><span class=k>foreign</span><span class=w> </span><span class=k>key</span><span class=p>(</span><span class=n>sid</span><span class=p>)</span><span class=w> </span><span class=k>references</span><span class=w> </span><span class=n>stu</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score3</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>default</span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score3</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>default</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score3</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>course_name</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>score3</span><span class=w> </span><span class=k>alter</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=n>course_name</span><span class=w> </span><span class=k>drop</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>自增主键</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>test_pk1</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>id</span><span class=w> </span><span class=nb>serial</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>,</span><span class=w> </span><span class=o>#</span><span class=n>serial</span><span class=err>自增</span><span class=w> </span><span class=err>范围</span><span class=mi>1</span><span class=w> </span><span class=err>到</span><span class=w> </span><span class=mi>2147483647</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>name</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=数据类型>数据类型<a hidden class=anchor aria-hidden=true href=#数据类型>#</a></h2><ul><li>smallint:范围：-32768-32767,2字节</li><li>int：-2147483648-2147483647,4字节</li><li>real：表示6位十进制数进度</li><li>numeric：numeric(m,n)表示整数部分m位，小数部分n位</li><li>time:一日之内的时间，格式为'10:10:10'</li><li>date:日期类型，格式为：&lsquo;2021-08-20&rsquo;</li><li>timestamp:时间戳类型，格式为'2021-08-20 10:10:10&rsquo;不能直接使用时间戳</li><li>char(n):定长字符串，如果插入的字符不足指定位数时，使用空白字符填充，检索效率比varchar高</li><li>varchar(n):边长字符串，如果插入的字符不足指定位数时，只存储值，不做其他操作</li><li>text:和varchar类似</li></ul><h2 id=管理工具>管理工具<a hidden class=anchor aria-hidden=true href=#管理工具>#</a></h2><p>官网下载pgAdmin，免费</p><p>下载好后在pgAdmin是有postgresql客户端的，在安装路径，如：F:\v5\runtime\psql.exe，可以把这个文件配置到环境变量，就可以在cmd终端直接使用psql命名</p><h2 id=数据导入>数据导入<a hidden class=anchor aria-hidden=true href=#数据导入>#</a></h2><p>导入命令：psql -h 139.198.11.13 -p5431 -d iot -U postgres -f F:\sql脚本\iot_device.sql</p><p>-h指定ip地址，默认本地</p><p>-p指定端口，默认5432</p><p>-d指定数据库</p><p>-U指定登录的用户</p><p>执行命令后如果不是本地会要求输入密码</p><p>从一个postgresql导出的数据如果在本地windows进行导入会出现编码转换错误：</p><p><img loading=lazy src=./images/Snipaste_2021-08-20_17-56-32.jpg alt></p><p>这是由于windows本地文件使用GBK进行编码，但是进行导入的postgresql数据库是UTF8编码，在windows上使用postgresql客户端进行文件传输并不会进行编码转换，直接使用的windows的GBK编码</p><h2 id=go-pg>go-pg<a hidden class=anchor aria-hidden=true href=#go-pg>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span>        <span class=kt>int64</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span>    <span class=p>[]</span><span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>tableName</span> <span class=kd>struct</span><span class=p>{}</span> <span class=s>`sql:&#34;user&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>Story</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span>        <span class=kt>int64</span>
</span></span><span class=line><span class=cl>		<span class=nx>Title</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>AuthorId</span>  <span class=kt>int64</span>
</span></span><span class=line><span class=cl>		<span class=nx>Author</span>    <span class=o>*</span><span class=nx>User</span>
</span></span><span class=line><span class=cl>		<span class=nx>tableName</span> <span class=kd>struct</span><span class=p>{}</span> <span class=s>`sql:&#34;story&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=nx>User</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;User&lt;%d %s %v&gt;&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Emails</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>Story</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Story&lt;%d %s %#v&gt;&#34;</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Title</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>Author</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>connect</span><span class=p>()</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span> <span class=o>:=</span> <span class=nx>pg</span><span class=p>.</span><span class=nf>Connect</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>pg</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Addr</span><span class=p>:</span>     <span class=s>&#34;139.198.11.13:5432&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>User</span><span class=p>:</span>     <span class=s>&#34;postgres&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Password</span><span class=p>:</span> <span class=s>&#34;995072337@Lt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Database</span><span class=p>:</span> <span class=s>&#34;test&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>n</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>QueryOne</span><span class=p>(</span><span class=nx>pg</span><span class=p>.</span><span class=nf>Scan</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>n</span><span class=p>),</span> <span class=s>&#34;select 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>db</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>createTables</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>,</span> <span class=nx>tabs</span> <span class=p>[]</span><span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>model</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tabs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>CreateTable</span><span class=p>(</span><span class=nx>model</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>orm</span><span class=p>.</span><span class=nx>CreateTableOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>IfNotExists</span><span class=p>:</span>   <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>FKConstraints</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>delTables</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>,</span> <span class=nx>tabs</span> <span class=p>[]</span><span class=kd>interface</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>model</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tabs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>DropTable</span><span class=p>(</span><span class=nx>model</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>orm</span><span class=p>.</span><span class=nx>DropTableOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>IfExists</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Cascade</span><span class=p>:</span>  <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>insert</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>u1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u1@163.com&#34;</span><span class=p>,</span> <span class=s>&#34;u1@qq.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>u2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u2@163.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Insert</span><span class=p>(</span><span class=nx>u1</span><span class=p>,</span> <span class=nx>u2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>u3</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u3@163.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>u4</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u4@163.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=nx>u3</span><span class=p>,</span> <span class=nx>u4</span><span class=p>).</span><span class=nf>Insert</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>u5</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u5@163.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>u6</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u6@163.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>users</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=o>*</span><span class=nx>User</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>users</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>users</span><span class=p>,</span> <span class=nx>u5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>users</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>users</span><span class=p>,</span> <span class=nx>u6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>users</span><span class=p>).</span><span class=nf>Insert</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>delUserRecord</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//按主键删除
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Delete</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span>     <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span>   <span class=s>&#34;u2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Emails</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;u2@163.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>User</span><span class=p>{}).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id in (?)&#34;</span><span class=p>,</span> <span class=nx>pg</span><span class=p>.</span><span class=nf>In</span><span class=p>([]</span><span class=kt>int64</span><span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>})).</span><span class=nf>Delete</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>delUserRecord2</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Delete</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>updateUserRecord</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span>   <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;u555&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Update</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>updateUserRecord2</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span>   <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;u666&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;name=?&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>.</span><span class=nx>Name</span><span class=p>).</span><span class=nf>WherePK</span><span class=p>().</span><span class=nf>Update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>updateUserRecord3</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span>   <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;u777&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Column</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>).</span><span class=nf>WherePK</span><span class=p>().</span><span class=nf>Update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>updateUserRecord4</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span>   <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;u888&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;name=?name&#34;</span><span class=p>).</span><span class=nf>WherePK</span><span class=p>().</span><span class=nf>Update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v \n&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query1</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>user</span> <span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Query</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>,</span> <span class=s>&#34;select * from users where id = ?&#34;</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v %#v \n&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query2</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>user</span> <span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=c1>//如果记过有多行 panic: pg: multiple rows in result set
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>QueryOne</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>,</span> <span class=s>&#34;select * from users where id &lt; ?&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v %#v \n&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query3</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ?id&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query4</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Column</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span> <span class=s>&#34;name&#34;</span><span class=p>).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ?id&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query5</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>id</span> <span class=kt>int64</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Column</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span> <span class=s>&#34;name&#34;</span><span class=p>).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ?&#34;</span><span class=p>,</span> <span class=mi>6</span><span class=p>).</span><span class=nf>Select</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>id</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query6</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ? and name = ?&#34;</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=s>&#34;u666&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// err := db.Model(&amp;user).Where(&#34;id = ?&#34;, 6).Where(&#34;name = ?&#34;, &#34;u666&#34;).Select()
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query7</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>user</span> <span class=o>:=</span> <span class=nx>User</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Id</span><span class=p>:</span>   <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;u777&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ?id&#34;</span><span class=p>).</span><span class=nf>WhereOr</span><span class=p>(</span><span class=s>&#34;name = ?name&#34;</span><span class=p>).</span><span class=nf>Limit</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nf>Select</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query8</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>users</span> <span class=p>[]</span><span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ?&#34;</span><span class=p>,</span> <span class=mi>6</span><span class=p>).</span><span class=nf>WhereOr</span><span class=p>(</span><span class=s>&#34;name = ?&#34;</span><span class=p>,</span> <span class=s>&#34;u777&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query9</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>users</span> <span class=p>[]</span><span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id &lt; ?&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>WhereGroup</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>q</span> <span class=o>*</span><span class=nx>orm</span><span class=p>.</span><span class=nx>Query</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>orm</span><span class=p>.</span><span class=nx>Query</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>q</span> <span class=p>=</span> <span class=nx>q</span><span class=p>.</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;name = ?&#34;</span><span class=p>,</span> <span class=s>&#34;u666&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>				<span class=nf>WhereOr</span><span class=p>(</span><span class=s>&#34;name = ?&#34;</span><span class=p>,</span> <span class=s>&#34;u777&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>q</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>		<span class=p>}).</span><span class=nf>Select</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query10</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>user</span> <span class=p>[]</span><span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id in (?)&#34;</span><span class=p>,</span> <span class=nx>pg</span><span class=p>.</span><span class=nf>In</span><span class=p>([]</span><span class=kt>int64</span><span class=p>{</span><span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>})).</span><span class=nf>Select</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query11</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id &lt; ?&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>).</span><span class=nf>Count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query12</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>users</span> <span class=p>[]</span><span class=nx>User</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id &lt; ?&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>).</span><span class=nf>Order</span><span class=p>(</span><span class=s>&#34;id desc&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query13</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>ids</span> <span class=p>[]</span><span class=kt>int64</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>ColumnExpr</span><span class=p>(</span><span class=s>&#34;array_agg(id)&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>(</span><span class=nx>pg</span><span class=p>.</span><span class=nf>Array</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>ids</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>ids</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query14</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=o>:=</span> <span class=nx>Story</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// err := db.Model(&amp;s).Relation(&#34;Author&#34;).Where(&#34;story.id = ?&#34;, 1).Select()
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>s</span><span class=p>).</span><span class=nf>Relation</span><span class=p>(</span><span class=s>&#34;Author&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>q</span> <span class=o>*</span><span class=nx>orm</span><span class=p>.</span><span class=nx>Query</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>orm</span><span class=p>.</span><span class=nx>Query</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>q</span><span class=p>.</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;story.id = ?&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}).</span><span class=nf>Select</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query15</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>ss</span> <span class=p>[]</span><span class=nx>Story</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>ss</span><span class=p>).</span><span class=nf>Column</span><span class=p>(</span><span class=s>&#34;story.*&#34;</span><span class=p>).</span><span class=nf>Relation</span><span class=p>(</span><span class=s>&#34;Author&#34;</span><span class=p>).</span><span class=nf>Select</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>ss</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query16</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>exist</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Where</span><span class=p>(</span><span class=s>&#34;id = ?&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>).</span><span class=nf>Exists</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>exist</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>query17</span><span class=p>(</span><span class=nx>db</span> <span class=o>*</span><span class=nx>pg</span><span class=p>.</span><span class=nx>DB</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>.</span><span class=nf>Model</span><span class=p>((</span><span class=o>*</span><span class=nx>User</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)).</span><span class=nf>Order</span><span class=p>(</span><span class=s>&#34;id desc&#34;</span><span class=p>).</span><span class=nf>ForEach</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>u</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://moyuduo.github.io/>Moyuduo's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>